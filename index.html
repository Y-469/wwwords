<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WordDrill - è‹±å˜èªãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>
<style>
:root {
  --bg: #0f1117;
  --surface: #1a1d27;
  --surface2: #242836;
  --border: #2e3345;
  --text: #e4e6ef;
  --text2: #8b8fa3;
  --accent: #6c5ce7;
  --accent2: #a29bfe;
  --correct: #00b894;
  --correct-bg: #00b89422;
  --wrong: #e17055;
  --wrong-bg: #e1705522;
  --warning: #fdcb6e;
  --radius: 12px;
  --radius-sm: 8px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Noto Sans JP', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100dvh;
  overflow-x: hidden;
}

/* ===== Layout ===== */
.app { max-width: 520px; margin: 0 auto; padding: 16px; min-height: 100dvh; display: flex; flex-direction: column; }

/* ===== Header ===== */
.header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px 0; margin-bottom: 8px;
}
.header h1 { font-size: 1.2rem; font-weight: 700; letter-spacing: -0.02em; }
.header h1 span { color: var(--accent2); }
.header-actions { display: flex; gap: 8px; }
.icon-btn {
  background: var(--surface); border: 1px solid var(--border); color: var(--text2);
  width: 36px; height: 36px; border-radius: var(--radius-sm);
  display: flex; align-items: center; justify-content: center; cursor: pointer;
  transition: all 0.15s;
}
.icon-btn:hover { background: var(--surface2); color: var(--text); }
.icon-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }

/* ===== Navigation Tabs ===== */
.nav {
  display: flex; gap: 4px; background: var(--surface); border-radius: var(--radius);
  padding: 4px; margin-bottom: 16px;
}
.nav-btn {
  flex: 1; padding: 10px 8px; border: none; background: transparent;
  color: var(--text2); font-size: 0.8rem; font-weight: 600; border-radius: var(--radius-sm);
  cursor: pointer; transition: all 0.2s; white-space: nowrap;
}
.nav-btn.active { background: var(--accent); color: #fff; }
.nav-btn:hover:not(.active) { color: var(--text); }

/* ===== Screens ===== */
.screen { display: none; flex: 1; flex-direction: column; }
.screen.active { display: flex; }

/* ===== Quiz Card ===== */
.quiz-progress {
  display: flex; align-items: center; gap: 12px; margin-bottom: 16px;
}
.progress-bar {
  flex: 1; height: 6px; background: var(--surface2); border-radius: 3px; overflow: hidden;
}
.progress-fill {
  height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent2));
  border-radius: 3px; transition: width 0.3s ease;
}
.progress-text { font-size: 0.75rem; color: var(--text2); font-weight: 600; white-space: nowrap; }

.card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 32px 24px; text-align: center;
  margin-bottom: 16px; position: relative; min-height: 140px;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
}
.card-label {
  position: absolute; top: 12px; left: 16px;
  font-size: 0.65rem; color: var(--text2); text-transform: uppercase;
  letter-spacing: 0.08em; font-weight: 600;
}
.card-word {
  font-size: 2rem; font-weight: 700; letter-spacing: -0.02em;
  margin-bottom: 4px;
}
.card-sub { font-size: 0.85rem; color: var(--text2); }

/* ===== Choices ===== */
.choices { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }
.choice-btn {
  padding: 14px 18px; background: var(--surface); border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); color: var(--text); font-size: 0.95rem;
  cursor: pointer; transition: all 0.15s; text-align: left;
  display: flex; align-items: center; gap: 12px;
}
.choice-btn .choice-key {
  width: 26px; height: 26px; border-radius: 6px; background: var(--surface2);
  display: flex; align-items: center; justify-content: center;
  font-size: 0.7rem; font-weight: 700; color: var(--text2); flex-shrink: 0;
}
.choice-btn:hover:not(.disabled) { border-color: var(--accent); background: var(--surface2); }
.choice-btn.correct { border-color: var(--correct); background: var(--correct-bg); }
.choice-btn.correct .choice-key { background: var(--correct); color: #fff; }
.choice-btn.wrong { border-color: var(--wrong); background: var(--wrong-bg); }
.choice-btn.wrong .choice-key { background: var(--wrong); color: #fff; }
.choice-btn.disabled { pointer-events: none; opacity: 0.5; }
.choice-btn.disabled.correct { opacity: 1; }

/* ===== Writing Mode ===== */
.writing-input-area { margin-bottom: 16px; }
.writing-input {
  width: 100%; padding: 14px 18px; background: var(--surface); border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); color: var(--text); font-size: 1.1rem;
  outline: none; transition: border-color 0.2s; font-family: inherit;
}
.writing-input:focus { border-color: var(--accent); }
.writing-input.correct { border-color: var(--correct); background: var(--correct-bg); }
.writing-input.wrong { border-color: var(--wrong); background: var(--wrong-bg); }

.writing-hint {
  margin-top: 8px; font-size: 0.8rem; color: var(--text2);
  min-height: 1.2em;
}
.writing-answer {
  margin-top: 8px; padding: 12px 16px; background: var(--surface2);
  border-radius: var(--radius-sm); font-size: 0.95rem;
}
.writing-answer strong { color: var(--accent2); }

/* ===== Action Buttons ===== */
.actions { display: flex; gap: 8px; margin-top: auto; padding-top: 12px; }
.btn {
  flex: 1; padding: 14px; border: none; border-radius: var(--radius-sm);
  font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.15s;
}
.btn-primary { background: var(--accent); color: #fff; }
.btn-primary:hover { background: var(--accent2); }
.btn-secondary { background: var(--surface2); color: var(--text); border: 1px solid var(--border); }
.btn-secondary:hover { background: var(--border); }
.btn:disabled { opacity: 0.4; cursor: default; }

/* ===== Results Screen ===== */
.results {
  text-align: center; padding: 24px 0;
}
.results-score {
  font-size: 4rem; font-weight: 800; color: var(--accent2);
  line-height: 1;
}
.results-label { font-size: 0.85rem; color: var(--text2); margin-top: 4px; }
.results-stats {
  display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;
  margin: 24px 0;
}
.stat-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius-sm); padding: 16px 8px;
}
.stat-value { font-size: 1.4rem; font-weight: 700; }
.stat-value.correct-color { color: var(--correct); }
.stat-value.wrong-color { color: var(--wrong); }
.stat-label { font-size: 0.7rem; color: var(--text2); margin-top: 2px; }

.wrong-words-list {
  text-align: left; margin: 16px 0;
}
.wrong-words-list h3 {
  font-size: 0.85rem; color: var(--wrong); margin-bottom: 8px;
}
.wrong-word-item {
  padding: 10px 14px; background: var(--surface); border-radius: var(--radius-sm);
  margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center;
  font-size: 0.9rem;
}
.wrong-word-item .en { font-weight: 600; }
.wrong-word-item .ja { color: var(--text2); font-size: 0.8rem; }

/* ===== Dashboard ===== */
.dash-section { margin-bottom: 20px; }
.dash-section h2 { font-size: 0.9rem; font-weight: 700; margin-bottom: 10px; }
.dash-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.dash-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 16px;
}
.dash-card .value { font-size: 1.8rem; font-weight: 800; }
.dash-card .label { font-size: 0.7rem; color: var(--text2); margin-top: 2px; }
.dash-card.accent .value { color: var(--accent2); }
.dash-card.green .value { color: var(--correct); }
.dash-card.red .value { color: var(--wrong); }
.dash-card.yellow .value { color: var(--warning); }

/* Calendar heatmap */
.calendar {
  display: flex; gap: 3px; flex-wrap: wrap; padding: 8px 0;
}
.cal-day {
  width: 18px; height: 18px; border-radius: 3px;
  background: var(--surface2); position: relative;
}
.cal-day.lv1 { background: #6c5ce744; }
.cal-day.lv2 { background: #6c5ce788; }
.cal-day.lv3 { background: #6c5ce7cc; }
.cal-day.lv4 { background: #6c5ce7; }
.cal-day-tooltip {
  display: none; position: absolute; bottom: 110%; left: 50%; transform: translateX(-50%);
  background: var(--surface); border: 1px solid var(--border); padding: 4px 8px;
  border-radius: 4px; font-size: 0.65rem; white-space: nowrap; z-index: 10;
  color: var(--text);
}
.cal-day:hover .cal-day-tooltip { display: block; }

/* Word mastery list */
.word-list { max-height: 400px; overflow-y: auto; }
.word-row {
  display: flex; align-items: center; padding: 10px 12px;
  border-bottom: 1px solid var(--border); gap: 10px;
}
.word-row:last-child { border-bottom: none; }
.word-mastery {
  width: 40px; height: 6px; background: var(--surface2); border-radius: 3px;
  overflow: hidden; flex-shrink: 0;
}
.word-mastery-fill { height: 100%; border-radius: 3px; }
.word-mastery-fill.low { background: var(--wrong); }
.word-mastery-fill.mid { background: var(--warning); }
.word-mastery-fill.high { background: var(--correct); }
.word-en { font-weight: 600; font-size: 0.85rem; min-width: 100px; }
.word-ja { font-size: 0.8rem; color: var(--text2); flex: 1; }
.word-acc { font-size: 0.75rem; color: var(--text2); font-weight: 600; }

/* ===== Setup / Mode Select ===== */
.mode-select { display: flex; flex-direction: column; gap: 10px; margin-bottom: 16px; }
.mode-card {
  padding: 16px 18px; background: var(--surface); border: 1.5px solid var(--border);
  border-radius: var(--radius); cursor: pointer; transition: all 0.15s;
}
.mode-card:hover { border-color: var(--accent); }
.mode-card.selected { border-color: var(--accent); background: #6c5ce711; }
.mode-card h3 { font-size: 0.95rem; margin-bottom: 4px; }
.mode-card p { font-size: 0.75rem; color: var(--text2); }

.range-group { margin-bottom: 16px; }
.range-group label {
  display: block; font-size: 0.8rem; color: var(--text2); margin-bottom: 6px;
}
.range-row { display: flex; gap: 8px; align-items: center; }
.range-row select {
  flex: 1; padding: 10px; background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius-sm); color: var(--text); font-size: 0.9rem;
}

/* ===== Toast ===== */
.toast {
  position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
  background: var(--surface); border: 1px solid var(--border);
  padding: 12px 24px; border-radius: var(--radius); font-size: 0.85rem;
  opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 100;
}
.toast.show { opacity: 1; }

/* ===== Scrollbar ===== */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

/* ===== Responsive ===== */
@media (max-width: 400px) {
  .card-word { font-size: 1.6rem; }
  .results-score { font-size: 3rem; }
}

/* ===== Animations ===== */
@keyframes slideIn {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}
.animate-in { animation: slideIn 0.25s ease; }

@keyframes pop {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}
.pop { animation: pop 0.2s ease; }

/* Streak flame effect */
.streak-display {
  display: flex; align-items: center; gap: 4px; font-size: 0.8rem;
  color: var(--warning); font-weight: 700;
}

/* ===== Sync Modal ===== */
.sync-overlay {
  display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6);
  z-index: 50; align-items: center; justify-content: center; padding: 16px;
}
.sync-overlay.open { display: flex; }
.sync-modal {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 24px; max-width: 400px; width: 100%;
}
.sync-modal h2 { font-size: 1rem; margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center; }
.sync-modal .close-btn { background: none; border: none; color: var(--text2); cursor: pointer; font-size: 1.4rem; line-height: 1; }
.sync-field { margin-bottom: 12px; }
.sync-field label { display: block; font-size: 0.75rem; color: var(--text2); margin-bottom: 4px; }
.sync-field input {
  width: 100%; padding: 10px; background: var(--surface2); border: 1px solid var(--border);
  border-radius: var(--radius-sm); color: var(--text); font-size: 0.85rem; outline: none;
}
.sync-field input:focus { border-color: var(--accent); }
.sync-note { font-size: 0.7rem; color: var(--text2); margin-bottom: 16px; line-height: 1.5; }
.sync-actions { display: flex; gap: 8px; }
.sync-status { margin-top: 12px; text-align: center; font-size: 0.75rem; color: var(--text2); word-break: break-all; }
.sync-status .connected { color: var(--correct); }
.sync-status .error { color: var(--wrong); }
.icon-btn.synced { background: var(--correct); color: #fff; border-color: var(--correct); }

/* ===== Reading ===== */
.card-passage {
  font-size: 0.95rem; line-height: 1.7; text-align: left; margin-bottom: 12px;
  color: var(--text); padding: 0 4px; white-space: pre-line;
}
.card-question {
  font-size: 0.85rem; color: var(--accent2); font-weight: 600;
  text-align: left; padding: 0 4px;
}
.read-explanation {
  background: var(--surface); border: 1px solid var(--border); border-left: 3px solid var(--accent);
  border-radius: var(--radius-sm); padding: 14px 16px; margin-bottom: 12px;
  font-size: 0.85rem; line-height: 1.6; animation: slideIn 0.25s ease;
}
.read-explanation .exp-label {
  font-size: 0.7rem; color: var(--accent2); font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px;
}
.read-explanation .exp-text { color: var(--text2); }
.read-explanation .exp-evidence {
  background: var(--surface2); border-left: 2px solid var(--accent2); padding: 8px 12px;
  margin: 8px 0 4px; font-size: 0.8rem; color: var(--text); line-height: 1.5;
  border-radius: 0 var(--radius-sm) var(--radius-sm) 0; font-style: italic;
}
.read-explanation .exp-evidence::before { content: "ğŸ“– æ ¹æ‹ : "; font-style: normal; font-weight: 600; color: var(--accent2); }
.read-timer { font-size: 0.7rem; color: var(--text3); text-align: right; margin-top: 4px; }
.choice-btn .strong-word {
  color: var(--wrong); font-weight: 700; text-decoration: underline;
  text-decoration-style: wavy; text-underline-offset: 2px;
}
.genre-tag {
  display: inline-block; font-size: 0.6rem; color: var(--accent2); background: var(--surface2);
  padding: 2px 8px; border-radius: 4px; font-weight: 600; text-transform: uppercase;
  position: absolute; top: 12px; right: 16px;
}
</style>
</head>
<body>
<div class="app">
  <!-- Header -->
  <div class="header">
    <h1>Word<span>Drill</span></h1>
    <div class="header-actions">
      <div class="streak-display" id="streakDisplay" style="display:none">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 23c-4.97 0-9-3.58-9-8 0-3.07 2.31-6.64 4.5-9 .37-.4 1.04-.07 1 .48-.11 1.57.52 3.27 1.76 4.4.2.18.52.04.52-.24 0-2.08 1.07-4.46 2.76-6.39.34-.39 1-.09 1 .44v3.4c0 1.42.82 2.71 2.12 3.12.58.18 1.08-.36.84-.92-.68-1.6-.29-3.34.7-4.6.26-.33.82-.2.88.2C19.55 9.5 21 12.74 21 15c0 4.42-4.03 8-9 8z"/></svg>
        <span id="streakCount">0</span>
      </div>
      <button class="icon-btn" id="syncBtn" onclick="openSyncModal()" title="ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 10h-1.26A8 8 0 109 20h9a5 5 0 000-10z"/></svg>
      </button>
      <button class="icon-btn" onclick="exportData()" title="ãƒ‡ãƒ¼ã‚¿æ›¸ãå‡ºã—">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
      </button>
      <button class="icon-btn" onclick="resetConfirm()" title="ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
      </button>
    </div>
  </div>

  <!-- Navigation -->
  <div class="nav">
    <button class="nav-btn active" onclick="showScreen('home')">ãƒ›ãƒ¼ãƒ </button>
    <button class="nav-btn" onclick="showScreen('quiz')">ã‚¯ã‚¤ã‚º</button>
    <button class="nav-btn" onclick="showScreen('writing')">è¨˜è¿°</button>
    <button class="nav-btn" onclick="showScreen('reading')">èª­è§£</button>
    <button class="nav-btn" onclick="showScreen('dashboard')">è¨˜éŒ²</button>
  </div>

  <!-- ===== HOME SCREEN ===== -->
  <div class="screen active" id="screen-home">
    <div class="dash-section">
      <h2>ä»Šæ—¥ã®å­¦ç¿’</h2>
      <div class="dash-grid">
        <div class="dash-card accent">
          <div class="value" id="homeTodayCount">0</div>
          <div class="label">å­¦ç¿’ã—ãŸå˜èª</div>
        </div>
        <div class="dash-card green">
          <div class="value" id="homeTodayAcc">-</div>
          <div class="label">æ­£ç­”ç‡</div>
        </div>
      </div>
    </div>

    <div class="dash-section">
      <h2>ãƒ¢ãƒ¼ãƒ‰é¸æŠ</h2>
      <div class="mode-select">
        <div class="mode-card" onclick="startQuiz('all')">
          <h3>4æŠã‚¯ã‚¤ã‚º - å…¨å˜èª</h3>
          <p>94èªã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ å‡ºé¡Œã€‚è‹±å˜èªâ†’æ—¥æœ¬èªã®æ„å‘³ã‚’é¸æŠ</p>
        </div>
        <div class="mode-card" onclick="startQuiz('weak')">
          <h3>4æŠã‚¯ã‚¤ã‚º - è‹¦æ‰‹å¾©ç¿’</h3>
          <p>æ­£ç­”ç‡ã®ä½ã„å˜èªã‚’å„ªå…ˆã—ã¦å‡ºé¡Œ</p>
        </div>
        <div class="mode-card" onclick="startQuiz('unseen')">
          <h3>4æŠã‚¯ã‚¤ã‚º - æœªå­¦ç¿’</h3>
          <p>ã¾ã ä¸€åº¦ã‚‚å‡ºé¡Œã•ã‚Œã¦ã„ãªã„å˜èª</p>
        </div>
        <div class="mode-card" onclick="startQuiz('all','ja2en')">
          <h3>4æŠã‚¯ã‚¤ã‚º(é€†) - å…¨å˜èª</h3>
          <p>æ—¥æœ¬èªâ†’è‹±å˜èªã®æ„å‘³ã‚’é¸æŠ</p>
        </div>
        <div class="mode-card" onclick="startQuiz('weak','ja2en')">
          <h3>4æŠã‚¯ã‚¤ã‚º(é€†) - è‹¦æ‰‹å¾©ç¿’</h3>
          <p>æ­£ç­”ç‡ã®ä½ã„å˜èªã‚’å„ªå…ˆã—ã¦å‡ºé¡Œ</p>
        </div>
        <div class="mode-card" onclick="startReading('all')">
          <h3>èª­è§£ Inference - å…¨å•</h3>
          <p>è‹±æ–‡ãƒ‘ãƒƒã‚»ãƒ¼ã‚¸ã‚’èª­ã¿ã€æ¨è«–å•é¡Œã«4æŠã§å›ç­”</p>
        </div>
        <div class="mode-card" onclick="startReading('weak')">
          <h3>èª­è§£ Inference - è‹¦æ‰‹å¾©ç¿’</h3>
          <p>æ­£ç­”ç‡ã®ä½ã„èª­è§£å•é¡Œã‚’å„ªå…ˆå‡ºé¡Œ</p>
        </div>
        <div class="mode-card" onclick="startWriting('all')">
          <h3>è¨˜è¿°ãƒ¢ãƒ¼ãƒ‰ - å…¨å˜èª</h3>
          <p>æ—¥æœ¬èªã®æ„å‘³ã‚’è¦‹ã¦è‹±å˜èªã‚’ã‚¿ã‚¤ãƒ—</p>
        </div>
        <div class="mode-card" onclick="startWriting('weak')">
          <h3>è¨˜è¿°ãƒ¢ãƒ¼ãƒ‰ - è‹¦æ‰‹å¾©ç¿’</h3>
          <p>é–“é•ãˆãŸå˜èªã®ã‚¹ãƒšãƒ«ç·´ç¿’</p>
        </div>
      </div>
    </div>

    <div class="dash-section">
      <h2>å˜èªæ•°è¨­å®š</h2>
      <div class="range-group">
        <label>1ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å‡ºé¡Œæ•°</label>
        <div class="range-row">
          <select id="questionCount">
            <option value="10">10å•</option>
            <option value="20" selected>20å•</option>
            <option value="30">30å•</option>
            <option value="50">50å•</option>
            <option value="94">å…¨94å•</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== QUIZ SCREEN ===== -->
  <div class="screen" id="screen-quiz">
    <!-- Active quiz -->
    <div id="quizActive">
      <div class="quiz-progress">
        <div class="progress-bar"><div class="progress-fill" id="quizProgressFill"></div></div>
        <div class="progress-text" id="quizProgressText">0 / 20</div>
      </div>
      <div class="card animate-in" id="quizCard">
        <div class="card-label">English</div>
        <div class="card-word" id="quizWord">implement</div>
      </div>
      <div class="choices" id="quizChoices"></div>
    </div>
    <!-- Quiz results -->
    <div id="quizResults" style="display:none">
      <div class="results animate-in">
        <div class="results-score" id="quizScore">85%</div>
        <div class="results-label">æ­£ç­”ç‡</div>
        <div class="results-stats">
          <div class="stat-card">
            <div class="stat-value" id="quizTotal">20</div>
            <div class="stat-label">å‡ºé¡Œæ•°</div>
          </div>
          <div class="stat-card">
            <div class="stat-value correct-color" id="quizCorrectCount">17</div>
            <div class="stat-label">æ­£è§£</div>
          </div>
          <div class="stat-card">
            <div class="stat-value wrong-color" id="quizWrongCount">3</div>
            <div class="stat-label">ä¸æ­£è§£</div>
          </div>
        </div>
        <div class="wrong-words-list" id="quizWrongList"></div>
        <div class="actions">
          <button class="btn btn-secondary" onclick="showScreen('home')">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
          <button class="btn btn-primary" onclick="retryWrong('quiz')">é–“é•ãˆãŸå˜èªã‚’å¾©ç¿’</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== WRITING SCREEN ===== -->
  <div class="screen" id="screen-writing">
    <div id="writingActive">
      <div class="quiz-progress">
        <div class="progress-bar"><div class="progress-fill" id="writeProgressFill"></div></div>
        <div class="progress-text" id="writeProgressText">0 / 20</div>
      </div>
      <div class="card animate-in" id="writeCard">
        <div class="card-label">æ—¥æœ¬èª</div>
        <div class="card-word" id="writeWord" style="font-size:1.5rem">å®Ÿè¡Œã™ã‚‹/å°å…¥ã™ã‚‹</div>
      </div>
      <div class="writing-input-area">
        <input type="text" class="writing-input" id="writeInput" placeholder="è‹±å˜èªã‚’å…¥åŠ›..." autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" inputmode="latin">
        <div class="writing-hint" id="writeHint"></div>
        <div class="writing-answer" id="writeAnswer" style="display:none"></div>
      </div>
      <div class="actions">
        <button class="btn btn-secondary" id="writeHintBtn" onclick="showWriteHint()">ãƒ’ãƒ³ãƒˆ</button>
        <button class="btn btn-primary" id="writeSubmitBtn" onclick="submitWriting()">å›ç­”ã™ã‚‹</button>
      </div>
    </div>
    <div id="writingResults" style="display:none">
      <div class="results animate-in">
        <div class="results-score" id="writeScore">85%</div>
        <div class="results-label">æ­£ç­”ç‡</div>
        <div class="results-stats">
          <div class="stat-card">
            <div class="stat-value" id="writeTotal">20</div>
            <div class="stat-label">å‡ºé¡Œæ•°</div>
          </div>
          <div class="stat-card">
            <div class="stat-value correct-color" id="writeCorrectCount">17</div>
            <div class="stat-label">æ­£è§£</div>
          </div>
          <div class="stat-card">
            <div class="stat-value wrong-color" id="writeWrongCount">3</div>
            <div class="stat-label">ä¸æ­£è§£</div>
          </div>
        </div>
        <div class="wrong-words-list" id="writeWrongList"></div>
        <div class="actions">
          <button class="btn btn-secondary" onclick="showScreen('home')">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
          <button class="btn btn-primary" onclick="retryWrong('writing')">é–“é•ãˆãŸå˜èªã‚’å¾©ç¿’</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== READING SCREEN ===== -->
  <div class="screen" id="screen-reading">
    <div id="readingActive">
      <div class="quiz-progress">
        <div class="progress-bar"><div class="progress-fill" id="readProgressFill"></div></div>
        <div class="progress-text" id="readProgressText">0 / 10</div>
      </div>
      <div class="card animate-in" id="readCard" style="text-align:left">
        <div class="card-label">Passage</div>
        <span class="genre-tag" id="readGenre"></span>
        <div class="card-passage" id="readPassage"></div>
        <div class="card-question" id="readQuestion"></div>
      </div>
      <div class="choices" id="readChoices"></div>
      <div class="read-explanation" id="readExplanation" style="display:none">
        <div class="exp-label">è§£èª¬</div>
        <div class="exp-evidence" id="readEvidence"></div>
        <div class="exp-text" id="readExpText"></div>
        <div class="read-timer" id="readTimer"></div>
      </div>
      <div class="actions">
        <button class="btn btn-primary" id="readNextBtn" onclick="nextReading()" style="display:none">æ¬¡ã®å•é¡Œ</button>
      </div>
    </div>
    <div id="readingResults" style="display:none">
      <div class="results animate-in">
        <div class="results-score" id="readScore">85%</div>
        <div class="results-label">æ­£ç­”ç‡</div>
        <div class="results-stats">
          <div class="stat-card">
            <div class="stat-value" id="readTotal">10</div>
            <div class="stat-label">å‡ºé¡Œæ•°</div>
          </div>
          <div class="stat-card">
            <div class="stat-value correct-color" id="readCorrectCount">8</div>
            <div class="stat-label">æ­£è§£</div>
          </div>
          <div class="stat-card">
            <div class="stat-value wrong-color" id="readWrongCount">2</div>
            <div class="stat-label">ä¸æ­£è§£</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="readAvgTime" style="font-size:1.2rem">--</div>
            <div class="stat-label">å¹³å‡å›ç­”æ™‚é–“</div>
          </div>
        </div>
        <div class="wrong-words-list" id="readWrongList"></div>
        <div class="actions">
          <button class="btn btn-secondary" onclick="showScreen('home')">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
          <button class="btn btn-primary" onclick="retryWrongReading()">é–“é•ãˆãŸå•é¡Œã‚’å¾©ç¿’</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== DASHBOARD SCREEN ===== -->
  <div class="screen" id="screen-dashboard">
    <div class="dash-section">
      <h2>å­¦ç¿’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆéå»30æ—¥ï¼‰</h2>
      <div class="calendar" id="calendar"></div>
    </div>
    <div class="dash-section">
      <h2>å…¨ä½“ã®çµ±è¨ˆ</h2>
      <div class="dash-grid">
        <div class="dash-card accent">
          <div class="value" id="dashTotalSessions">0</div>
          <div class="label">ç·ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°</div>
        </div>
        <div class="dash-card green">
          <div class="value" id="dashOverallAcc">-</div>
          <div class="label">å…¨ä½“æ­£ç­”ç‡</div>
        </div>
        <div class="dash-card yellow">
          <div class="value" id="dashStreak">0</div>
          <div class="label">é€£ç¶šå­¦ç¿’æ—¥æ•°</div>
        </div>
        <div class="dash-card">
          <div class="value" id="dashMastered">0</div>
          <div class="label">ç¿’å¾—æ¸ˆã¿ï¼ˆ80%â†‘ï¼‰</div>
        </div>
      </div>
    </div>
    <div class="dash-section">
      <h2>å˜èªä¸€è¦§ï¼ˆæ­£ç­”ç‡é †ï¼‰</h2>
      <div class="word-list" id="wordList"></div>
    </div>
  </div>
</div>

<!-- Sync Modal -->
<div class="sync-overlay" id="syncModal">
  <div class="sync-modal">
    <h2>ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸè¨­å®š <button class="close-btn" onclick="closeSyncModal()">&times;</button></h2>
    <div class="sync-field">
      <label>Database URL</label>
      <input id="syncDbUrl" type="text" placeholder="https://xxx-default-rtdb.firebaseio.com">
    </div>
    <div class="sync-field">
      <label>API Key</label>
      <input id="syncApiKey" type="text" placeholder="AIzaSy...">
    </div>
    <div class="sync-field">
      <label>åŒæœŸIDï¼ˆåˆè¨€è‘‰ï¼‰</label>
      <input id="syncIdInput" type="text" placeholder="å¥½ããªåˆè¨€è‘‰ã‚’å…¥åŠ›">
    </div>
    <div class="sync-note">
      åŒã˜Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨åˆè¨€è‘‰ã‚’è¨­å®šã™ã‚Œã°ã€PCãƒ»ã‚¹ãƒãƒ›é–“ã§ãƒ‡ãƒ¼ã‚¿ãŒè‡ªå‹•åŒæœŸã•ã‚Œã¾ã™ã€‚
    </div>
    <div class="sync-actions">
      <button onclick="disconnectSync()" class="btn btn-secondary" style="flex:1">è§£é™¤</button>
      <button onclick="startSync()" class="btn btn-primary" style="flex:1">åŒæœŸé–‹å§‹</button>
    </div>
    <div class="sync-status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: <span id="syncStatus">æœªæ¥ç¶š</span></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database-compat.js"></script>
<script>
// ===== WORD DATA =====
const WORDS = [
  {"en":"implement","ja":"å®Ÿè¡Œã™ã‚‹/å°å…¥ã™ã‚‹"},
  {"en":"enhance","ja":"é«˜ã‚ã‚‹/å¼·åŒ–ã™ã‚‹"},
  {"en":"sustainability","ja":"æŒç¶šå¯èƒ½æ€§"},
  {"en":"financial","ja":"è²¡å‹™ã®/çµŒæ¸ˆçš„ãª"},
  {"en":"pressure","ja":"åœ§åŠ›/ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼"},
  {"en":"decline","ja":"æ¸›å°‘ã™ã‚‹/è¡°é€€"},
  {"en":"revenue","ja":"åç›Š"},
  {"en":"profit","ja":"åˆ©ç›Š"},
  {"en":"investment","ja":"æŠ•è³‡"},
  {"en":"competitive","ja":"ç«¶äº‰åŠ›ã®ã‚ã‚‹"},
  {"en":"efficient","ja":"åŠ¹ç‡çš„ãª"},
  {"en":"strategy","ja":"æˆ¦ç•¥"},
  {"en":"policy","ja":"æ–¹é‡"},
  {"en":"impact","ja":"å½±éŸ¿"},
  {"en":"significant","ja":"é‡è¦ãª/ã‹ãªã‚Šã®"},
  {"en":"approach","ja":"æ–¹æ³•/å–ã‚Šçµ„ã¿"},
  {"en":"maintain","ja":"ç¶­æŒã™ã‚‹"},
  {"en":"expand","ja":"æ‹¡å¤§ã™ã‚‹"},
  {"en":"reduce","ja":"æ¸›ã‚‰ã™"},
  {"en":"increase","ja":"å¢—ã‚„ã™/å¢—ãˆã‚‹"},
  {"en":"launch","ja":"é–‹å§‹ã™ã‚‹/ç™ºå£²ã™ã‚‹"},
  {"en":"introduce","ja":"å°å…¥ã™ã‚‹"},
  {"en":"consider","ja":"æ¤œè¨ã™ã‚‹"},
  {"en":"improve","ja":"æ”¹å–„ã™ã‚‹"},
  {"en":"develop","ja":"ç™ºå±•ã•ã›ã‚‹"},
  {"en":"manage","ja":"ç®¡ç†ã™ã‚‹/ä½•ã¨ã‹ã™ã‚‹"},
  {"en":"achieve","ja":"é”æˆã™ã‚‹"},
  {"en":"require","ja":"å¿…è¦ã¨ã™ã‚‹"},
  {"en":"provide","ja":"æä¾›ã™ã‚‹"},
  {"en":"respond","ja":"å¯¾å¿œã™ã‚‹"},
  {"en":"complaint","ja":"è‹¦æƒ…"},
  {"en":"issue","ja":"å•é¡Œ"},
  {"en":"delay","ja":"é…å»¶"},
  {"en":"risk","ja":"ãƒªã‚¹ã‚¯"},
  {"en":"opportunity","ja":"æ©Ÿä¼š"},
  {"en":"growth","ja":"æˆé•·"},
  {"en":"performance","ja":"æ¥­ç¸¾/æˆæœ"},
  {"en":"customer","ja":"é¡§å®¢"},
  {"en":"employee","ja":"å¾“æ¥­å“¡"},
  {"en":"department","ja":"éƒ¨é–€"},
  {"en":"organization","ja":"çµ„ç¹”"},
  {"en":"headquarters","ja":"æœ¬ç¤¾"},
  {"en":"supplier","ja":"ä¾›çµ¦æ¥­è€…"},
  {"en":"client","ja":"é¡§å®¢/å–å¼•å…ˆ"},
  {"en":"contract","ja":"å¥‘ç´„"},
  {"en":"agreement","ja":"åˆæ„"},
  {"en":"budget","ja":"äºˆç®—"},
  {"en":"cost-effective","ja":"è²»ç”¨å¯¾åŠ¹æœã®é«˜ã„"},
  {"en":"productivity","ja":"ç”Ÿç”£æ€§"},
  {"en":"satisfaction","ja":"æº€è¶³"},
  {"en":"turnover","ja":"é›¢è·ç‡/å£²ä¸Šé«˜"},
  {"en":"partnership","ja":"ææº"},
  {"en":"market","ja":"å¸‚å ´"},
  {"en":"market share","ja":"å¸‚å ´ã‚·ã‚§ã‚¢"},
  {"en":"competition","ja":"ç«¶äº‰"},
  {"en":"demand","ja":"éœ€è¦"},
  {"en":"supply","ja":"ä¾›çµ¦"},
  {"en":"sales","ja":"å£²ä¸Š"},
  {"en":"distribution","ja":"æµé€š"},
  {"en":"promotion","ja":"è²©ä¿ƒ"},
  {"en":"advertisement","ja":"åºƒå‘Š"},
  {"en":"survey","ja":"èª¿æŸ»"},
  {"en":"analysis","ja":"åˆ†æ"},
  {"en":"report","ja":"å ±å‘Š"},
  {"en":"proposal","ja":"ææ¡ˆ"},
  {"en":"recommendation","ja":"æ¨è–¦"},
  {"en":"decision","ja":"æ±ºå®š"},
  {"en":"option","ja":"é¸æŠè‚¢"},
  {"en":"alternative","ja":"ä»£æ›¿æ¡ˆ"},
  {"en":"solution","ja":"è§£æ±ºç­–"},
  {"en":"benefit","ja":"åˆ©ç›Š/åˆ©ç‚¹"},
  {"en":"advantage","ja":"åˆ©ç‚¹"},
  {"en":"disadvantage","ja":"æ¬ ç‚¹"},
  {"en":"challenge","ja":"èª²é¡Œ"},
  {"en":"environment","ja":"ç’°å¢ƒ"},
  {"en":"innovation","ja":"é©æ–°"},
  {"en":"technology","ja":"æŠ€è¡“"},
  {"en":"system","ja":"ã‚·ã‚¹ãƒ†ãƒ "},
  {"en":"operation","ja":"é‹å–¶"},
  {"en":"process","ja":"éç¨‹"},
  {"en":"procedure","ja":"æ‰‹é †"},
  {"en":"schedule","ja":"äºˆå®š"},
  {"en":"deadline","ja":"ç· åˆ‡"},
  {"en":"update","ja":"æ›´æ–°"},
  {"en":"review","ja":"è¦‹ç›´ã—"},
  {"en":"approve","ja":"æ‰¿èªã™ã‚‹"},
  {"en":"reject","ja":"æ‹’å¦ã™ã‚‹"},
  {"en":"cancel","ja":"å–æ¶ˆã™"},
  {"en":"reschedule","ja":"æ—¥ç¨‹å¤‰æ›´ã™ã‚‹"},
  {"en":"refund","ja":"è¿”é‡‘"},
  {"en":"replace","ja":"äº¤æ›ã™ã‚‹"},
  {"en":"emergency","ja":"ç·Šæ€¥äº‹æ…‹"},
  {"en":"damage","ja":"æå®³"},
  {"en":"repair","ja":"ä¿®ç†ã™ã‚‹"}
];

// ===== READING DATA =====
const READING_QUESTIONS = [{"id":1,"genre":"finance","style":"meeting_minutes","qtype":"tone","passage":"Minutes: Weekly review\n1) Background: a public agency has been dealing with declining attendance.\n2) Data: retention improved noticeably at sites that used the updated checklist; other sites showed no change.\n3) Discussion: Some members argued the trial was too short, while others pointed to complaints as an early warning sign. For instance, the group agreed that the next step is to standardize reporting so results can be compared fairly.\n4) Decision: Continue a pilot program for one more cycle and revisit the plan with clearer evidence.","question":"Which word best describes the tone of the passage?","choices":["playful","sarcastic","measured","furious"],"answer":2,"evidence":"Minutes: Weekly review 1) Background: a public agency has been dealing with declining attendance."},{"id":2,"genre":"science_general","style":"op_ed","qtype":"best_title","passage":"It is tempting to declare a reporting system a success the moment complaint volume ticks upward.\n\nThat temptation is exactly what undermines good decisions.\n\nIn my view, a mid-sized manufacturer has treated rising costs as a problem of effort rather than design.\n\nPeople work harder, outcomes wobble, and leadership calls it â€œprogress.â€ real improvement comes from removing friction: clearer rules, better tools, and fewer exceptions. On the other hand if the trial continues, it should be evaluated against a baseline, not against last weekâ€™s mood.","question":"Which title best fits the passage?","choices":["How to Build a Keyboard From Scratch","Measuring Success Beyond Short-Term Numbers","Ten Beaches to Visit This Summer","A Guide to Cooking for Large Events"],"answer":1,"evidence":"It is tempting to declare a reporting system a success the moment complaint volume ticks upward."},{"id":3,"genre":"hr_workplace","style":"interview_qna","qtype":"tone","passage":"Q: Why did you expand a pricing change?\nA: We needed a practical response to rising costs. We werenâ€™t looking for a miracle; we wanted stable gains in error rate.\n\nQ: Did it work?\nA: The picture is limited. Some teams improved slightly, but others struggled because they lacked shared definitions. Meanwhile we learned that the change requires coaching, not just an announcement. In contrast weâ€™ll adjust the plan and continue collecting data before making a final decision.","question":"Which word best describes the tone of the passage?","choices":["analytical","furious","playful","sarcastic"],"answer":0,"evidence":"A: We needed a practical response to rising costs."},{"id":4,"genre":"education_training","style":"case_study","qtype":"inference","passage":"Case study: Turning around error rate\n\nWhen a software startup noticed system outages, it tested a service upgrade for a three-month trial. Teams received a short guide and a single target. Results were encouraging: the best sites improved error rate slightly, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. The company revised the guide with concrete examples and removed optional steps. So leaders plan to scale the approach only after confirming the same gains in a second region.","question":"What can be inferred from the passage?","choices":["The initiative has already been proven successful everywhere.","The organization has decided to cancel the initiative immediately.","The passage states that costs will definitely fall next month.","Short-term data alone may not be enough to judge whether the change works."],"answer":3,"evidence":"Results were encouraging: the best sites improved error rate slightly, while the weakest sites barely moved."},{"id":5,"genre":"finance","style":"internal_memo","qtype":"best_title","passage":"To: All staff\nSubject: Update on a pricing change\n\nWe have phased in a pricing change in the last six months in response to delayed shipments. Please note that the goal is not to maximize output at any cost; it is to improve response time without increasing risk. If you notice confusion about responsibilities, flag it to your lead immediately. In addition, do not assume that a single good week proves the change is working. Instead, we will review results after the next reporting cycle and adjust the guidelines where needed.","question":"Which title best fits the passage?","choices":["A Guide to Cooking for Large Events","Ten Beaches to Visit This Summer","A Trial Program Shows Why Consistency Matters","How to Build a Keyboard From Scratch"],"answer":2,"evidence":"To: All staff  Subject: Update on a pricing change   We have phased in a pricing change in the last six months in response to delayed shipments."},{"id":6,"genre":"customer_service","style":"interview_qna","qtype":"reference","passage":"Q: Why did you introduc a service upgrade?\nA: We needed a practical response to declining attendance. We werenâ€™t looking for a miracle; we wanted stable gains in response time.\n\nQ: Did it work?\nA: The picture is uneven. Some teams improved at first, but others struggled because they lacked shared definitions. We learned that the change requires coaching, not just an announcement. Meanwhile weâ€™ll adjust the plan and continue collecting data before making a final decision.","question":"In the passage, the word 'it' most likely refers to what?","choices":["the Atlantic Ocean","the change","the weather","the equator"],"answer":1,"evidence":"We werenâ€™t looking for a miracle; we wanted stable gains in response time. Q: Did it work?"},{"id":7,"genre":"travel_transport","style":"meeting_minutes","qtype":"best_title","passage":"Minutes: Weekly review\n1) Background: a regional bank has been dealing with system outages.\n2) Data: complaint volume improved initially at sites that used the updated checklist; other sites showed no change.\n3) Discussion: Some members argued the trial was too short, while others pointed to complaints as an early warning sign. The group agreed that the next step is to standardize reporting so results can be compared fairly.\n4) Decision: Continue a service upgrade for one more cycle and revisit the plan with clearer evidence.","question":"Which title best fits the passage?","choices":["Mixed Results Lead to Refinement, Not Retreat","Ten Beaches to Visit This Summer","How to Build a Keyboard From Scratch","A Guide to Cooking for Large Events"],"answer":0,"evidence":"Minutes: Weekly review  1) Background: a regional bank has been dealing with system outages."},{"id":8,"genre":"health","style":"email_thread","qtype":"purpose","passage":"From: Maya To: Project group Iâ€™m concerned that customer satisfaction has worsened since we introduced a reporting system. Several customers mentioned system outages in their last calls. Nevertheless I also saw one branch improve gradually, which makes me think execution differs by team.\n\nReply (Alex): We should separate the change itself from training. The checklist wasnâ€™t shared with new hires. Conversely letâ€™s run a short refresher session and compare results over two weeks before we reverse the decision.","question":"What is the primary purpose of the passage?","choices":["To report mixed outcomes and recommend next steps.","To advertise a product with limited stock.","To provide step-by-step technical instructions for installing software.","To entertain readers with a fictional story."],"answer":0,"evidence":"From: Maya To: Project group Iâ€™m concerned that customer satisfaction has worsened since we introduced a reporting system."},{"id":9,"genre":"customer_service","style":"interview_qna","qtype":"best_title","passage":"Q: Why did you phas in a training series?\nA: We needed a practical response to rising costs. We werenâ€™t looking for a miracle; we wanted stable gains in retention.\n\nQ: Did it work?\nA: The picture is surprising. Some teams improved at first, but others struggled because they lacked shared definitions. By comparison we learned that the change requires coaching, not just an announcement. On the other hand weâ€™ll adjust the plan and continue collecting data before making a final decision.","question":"Which title best fits the passage?","choices":["A Guide to Cooking for Large Events","A Trial Program Shows Why Consistency Matters","Ten Beaches to Visit This Summer","How to Build a Keyboard From Scratch"],"answer":1,"evidence":"Q: Why did you phas in a training series?"},{"id":10,"genre":"science_general","style":"interview_qna","qtype":"purpose","passage":"Q: Why did you test a maintenance schedule?\nA: We needed a practical response to delayed shipments. We werenâ€™t looking for a miracle; we wanted stable gains in customer satisfaction.\n\nQ: Did it work?\nA: The picture is encouraging. Some teams improved initially, but others struggled because they lacked shared definitions. Nevertheless we learned that the change requires coaching, not just an announcement. Weâ€™ll adjust the plan and continue collecting data before making a final decision.","question":"What is the primary purpose of the passage?","choices":["To explain why a trial is continuing despite criticism.","To entertain readers with a fictional story.","To provide step-by-step technical instructions for installing software.","To advertise a product with limited stock."],"answer":0,"evidence":"We werenâ€™t looking for a miracle; we wanted stable gains in customer satisfaction."},{"id":11,"genre":"society_culture","style":"email_thread","qtype":"best_title","passage":"From: Maya To: Project group Iâ€™m concerned that revenue per user has worsened since we tested a training series. Several customers mentioned declining attendance in their last calls. Furthermore I also saw one branch improve slightly, which makes me think execution differs by team.\n\nReply (Alex): We should separate the change itself from training. The checklist wasnâ€™t shared with new hires. Letâ€™s run a short refresher session and compare results over two weeks before we reverse the decision.","question":"Which title best fits the passage?","choices":["How to Build a Keyboard From Scratch","Measuring Success Beyond Short-Term Numbers","A Guide to Cooking for Large Events","Ten Beaches to Visit This Summer"],"answer":1,"evidence":"From: Maya To: Project group Iâ€™m concerned that revenue per user has worsened since we tested a training series."},{"id":12,"genre":"health","style":"op_ed","qtype":"best_title","passage":"It is tempting to declare a service upgrade a success the moment response time ticks upward.\n\nThat temptation is exactly what undermines good decisions.\n\nIn my view, a public agency has treated delayed shipments as a problem of effort rather than design.\n\nPeople work harder, outcomes wobble, and leadership calls it â€œprogress.â€ instead real improvement comes from removing friction: clearer rules, better tools, and fewer exceptions. Nevertheless if the trial continues, it should be evaluated against a baseline, not against last weekâ€™s mood.","question":"Which title best fits the passage?","choices":["A Guide to Cooking for Large Events","A Trial Program Shows Why Consistency Matters","Ten Beaches to Visit This Summer","How to Build a Keyboard From Scratch"],"answer":1,"evidence":"It is tempting to declare a service upgrade a success the moment response time ticks upward."},{"id":13,"genre":"society_culture","style":"news_article","qtype":"tone","passage":"A public agency has revised a pricing change after the holiday season, aiming to address customer churn.\n\nEarly figures show limited results: energy use improved at first in some locations, but changed little in others. Managers say the biggest obstacle is consistencyâ€”local teams interpret the guidance differently, and some lack the tools to track outcomes. On the other hand, analysts caution that short-term data can be misleading because seasonal demand distorts comparisons. Conversely, the organization plans to keep the trial running and publish clearer benchmarks before deciding on a wider rollout.","question":"Which word best describes the tone of the passage?","choices":["playful","measured","sarcastic","furious"],"answer":1,"evidence":"on the other hand, analysts caution that short-term data can be misleading because seasonal demand distorts comparisons."},{"id":14,"genre":"environment","style":"internal_memo","qtype":"purpose","passage":"To: All staff\nSubject: Update on a pilot program\n\nWe have introduced a pilot program since early spring in response to customer churn. Please note that the goal is not to maximize output at any cost; it is to improve response time without increasing risk. If you notice confusion about responsibilities, flag it to your lead immediately. For instance, do not assume that a single good week proves the change is working. Consequently, we will review results after the next reporting cycle and adjust the guidelines where needed.","question":"What is the primary purpose of the passage?","choices":["To provide step-by-step technical instructions for installing software.","To advertise a product with limited stock.","To report mixed outcomes and recommend next steps.","To entertain readers with a fictional story."],"answer":2,"evidence":"To: All staff Subject: Update on a pilot program We have introduced a pilot program since early spring in response to customer churn."},{"id":15,"genre":"environment","style":"interview_qna","qtype":"purpose","passage":"Q: Why did you expand a training series?\nA: We needed a practical response to data privacy concerns. We werenâ€™t looking for a miracle; we wanted stable gains in complaint volume.\n\nQ: Did it work?\nA: The picture is surprising. Some teams improved at first, but others struggled because they lacked shared definitions. Conversely we learned that the change requires coaching, not just an announcement. As a result weâ€™ll adjust the plan and continue collecting data before making a final decision.","question":"What is the primary purpose of the passage?","choices":["To entertain readers with a fictional story.","To advertise a product with limited stock.","To report mixed outcomes and recommend next steps.","To provide step-by-step technical instructions for installing software."],"answer":2,"evidence":"We werenâ€™t looking for a miracle; we wanted stable gains in complaint volume."},{"id":16,"genre":"hr_workplace","style":"email_thread","qtype":"purpose","passage":"From: Maya To: Project group Iâ€™m concerned that revenue per user has worsened since we introduced a training series. Several customers mentioned customer churn in their last calls. I also saw one branch improve at first, which makes me think execution differs by team.\n\nReply (Alex): We should separate the change itself from training. The checklist wasnâ€™t shared with new hires. For instance letâ€™s run a short refresher session and compare results over two weeks before we reverse the decision.","question":"What is the primary purpose of the passage?","choices":["To entertain readers with a fictional story.","To explain why a trial is continuing despite criticism.","To advertise a product with limited stock.","To provide step-by-step technical instructions for installing software."],"answer":1,"evidence":"From: Maya To: Project group Iâ€™m concerned that revenue per user has worsened since we introduced a training series."},{"id":17,"genre":"education_training","style":"report_summary","qtype":"best_title","passage":"Summary report Objective: reduce data privacy concerns and improve retention.\n\nMethod: introduced a training series since early spring across multiple sites. Findings: outcomes were steady. Sites with clear ownership improved retention noticeably; sites with frequent staff changes did not. Meanwhile qualitative feedback suggests the instructions were interpreted inconsistently. Nevertheless the recommendation is to refine the guidance, retrain affected teams, and reassess after the next cycle.","question":"Which title best fits the passage?","choices":["Ten Beaches to Visit This Summer","A Guide to Cooking for Large Events","How to Build a Keyboard From Scratch","Mixed Results Lead to Refinement, Not Retreat"],"answer":3,"evidence":"Summary report Objective: reduce data privacy concerns and improve retention."},{"id":18,"genre":"education_training","style":"internal_memo","qtype":"reference","passage":"To: All staff\nSubject: Update on a new policy\n\nWe have phased in a new policy over the past year in response to staff fatigue. Please note that the goal is not to maximize output at any cost; it is to improve on-time delivery without increasing risk. If you notice confusion about responsibilities, flag it to your lead immediately. On the other hand, do not assume that a single good week proves the change is working. Nevertheless, we will review results after the next reporting cycle and adjust the guidelines where needed.","question":"In the passage, the word 'it' most likely refers to what?","choices":["the weather","the new policy","the equator","the Atlantic Ocean"],"answer":1,"evidence":"To: All staff Subject: Update on a new policy We have phased in a new policy over the past year in response to staff fatigue. Please note that the goal is not to maximize output at any cost; it is to improve on-time delivery without increasing risk."},{"id":19,"genre":"finance","style":"meeting_minutes","qtype":"tone","passage":"Minutes: Weekly review\n1) Background: a logistics firm has been dealing with traffic congestion.\n2) Data: energy use improved only at sites that used the updated checklist; other sites showed no change.\n3) Discussion: Some members argued the trial was too short, while others pointed to complaints as an early warning sign. Consequently, the group agreed that the next step is to standardize reporting so results can be compared fairly.\n4) Decision: Continue an internal tool for one more cycle and revisit the plan with clearer evidence.","question":"Which word best describes the tone of the passage?","choices":["furious","playful","sarcastic","pragmatic"],"answer":3,"evidence":"Minutes: Weekly review 1) Background: a logistics firm has been dealing with traffic congestion."},{"id":20,"genre":"society_culture","style":"news_article","qtype":"reference","passage":"A regional bank has introduced a reporting system after the holiday season, aiming to address system outages.\n\nEarly figures show encouraging results: error rate improved slightly in some locations, but changed little in others. Managers say the biggest obstacle is consistencyâ€”local teams interpret the guidance differently, and some lack the tools to track outcomes. In addition, analysts caution that short-term data can be misleading because seasonal demand distorts comparisons. Meanwhile, the organization plans to keep the trial running and publish clearer benchmarks before deciding on a wider rollout. Overall, it will be judged against longer-term trends rather than a single week.","question":"In the passage, the word 'it' most likely refers to what?","choices":["the equator","the weather","the initiative","the Atlantic Ocean"],"answer":2,"evidence":"Overall, it will be judged against longer-term trends rather than a single week."},{"id":21,"genre":"science_general","style":"case_study","qtype":"main_idea","passage":"Case study: Turning around complaint volume\n\nWhen a university noticed declining attendance, it introduced a pricing change for a three-month trial. Teams received a short guide and a single target. Results were uneven: the best sites improved complaint volume gradually, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. The company revised the guide with concrete examples and removed optional steps. Leaders plan to scale the approach only after confirming the same gains in a second region.","question":"Which statement best expresses the main idea of the passage?","choices":["The passage explains the history of a river system in detail.","The passage argues that financial profit is the only meaningful goal.","The passage is mainly about replacing all staff with automation.","A new initiative shows uneven results, and the next step is to improve consistency before scaling."],"answer":3,"evidence":"Case study: Turning around complaint volume   When a university noticed declining attendance, it introduced a pricing change for a three-month trial."},{"id":22,"genre":"environment","style":"case_study","qtype":"purpose","passage":"Case study: Turning around on-time delivery\n\nWhen a regional bank noticed traffic congestion, it revised a training series for a three-month trial. Teams received a short guide and a single target. Results were encouraging: the best sites improved on-time delivery slightly, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. Nevertheless the company revised the guide with concrete examples and removed optional steps. Instead leaders plan to scale the approach only after confirming the same gains in a second region.","question":"What is the primary purpose of the passage?","choices":["To entertain readers with a fictional story.","To advertise a product with limited stock.","To describe a recent change and discuss how it is being evaluated.","To provide step-by-step technical instructions for installing software."],"answer":2,"evidence":"Case study: Turning around on-time delivery   When a regional bank noticed traffic congestion, it revised a training series for a three-month trial."},{"id":23,"genre":"hr_workplace","style":"op_ed","qtype":"tone","passage":"It is tempting to declare an internal tool a success the moment retention ticks upward.\n\nThat temptation is exactly what undermines good decisions.\n\nIn my view, a mid-sized manufacturer has treated delayed shipments as a problem of effort rather than design.\n\nPeople work harder, outcomes wobble, and leadership calls it â€œprogress.â€ meanwhile real improvement comes from removing friction: clearer rules, better tools, and fewer exceptions. Also if the trial continues, it should be evaluated against a baseline, not against last weekâ€™s mood.","question":"Which word best describes the tone of the passage?","choices":["playful","cautious","sarcastic","furious"],"answer":1,"evidence":"It is tempting to declare an internal tool a success the moment retention ticks upward."},{"id":24,"genre":"environment","style":"case_study","qtype":"inference","passage":"Case study: Turning around error rate\n\nWhen a retail chain noticed declining attendance, it phased in a service upgrade for a three-month trial. Teams received a short guide and a single target. Results were uneven: the best sites improved error rate at first, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. Nevertheless the company revised the guide with concrete examples and removed optional steps. Also leaders plan to scale the approach only after confirming the same gains in a second region.","question":"What can be inferred from the passage?","choices":["The initiative has already been proven successful everywhere.","The passage states that costs will definitely fall next month.","Short-term data alone may not be enough to judge whether the change works.","The organization has decided to cancel the initiative immediately."],"answer":2,"evidence":"Results were uneven: the best sites improved error rate at first, while the weakest sites barely moved."},{"id":25,"genre":"business_strategy","style":"case_study","qtype":"reference","passage":"Case study: Turning around on-time delivery\n\nWhen a mid-sized manufacturer noticed traffic congestion, it expanded a reporting system for a three-month trial. Teams received a short guide and a single target. Results were mixed: the best sites improved on-time delivery gradually, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. Meanwhile the company revised the guide with concrete examples and removed optional steps. Leaders plan to scale the approach only after confirming the same gains in a second region.","question":"In the passage, the word 'it' most likely refers to what?","choices":["the Atlantic Ocean","the equator","the new policy","the weather"],"answer":2,"evidence":"Case study: Turning around on-time delivery When a mid-sized manufacturer noticed traffic congestion, it expanded a reporting system for a three-month trial."},{"id":26,"genre":"environment","style":"email_thread","qtype":"inference","passage":"From: Maya To: Project group Iâ€™m concerned that error rate has worsened since we paused a maintenance schedule. Several customers mentioned data privacy concerns in their last calls. By comparison I also saw one branch improve noticeably, which makes me think execution differs by team.\n\nReply (Alex): We should separate the change itself from training. The checklist wasnâ€™t shared with new hires. For instance letâ€™s run a short refresher session and compare results over two weeks before we reverse the decision.","question":"What can be inferred from the passage?","choices":["The passage states that costs will definitely fall next month.","The organization has decided to cancel the initiative immediately.","The organization is continuing the initiative while refining how it is implemented.","The initiative has already been proven successful everywhere."],"answer":2,"evidence":"From: Maya To: Project group Iâ€™m concerned that error rate has worsened since we paused a maintenance schedule."},{"id":27,"genre":"travel_transport","style":"email_thread","qtype":"main_idea","passage":"From: Maya To: Project group Iâ€™m concerned that response time has worsened since we paused a new policy. Several customers mentioned system outages in their last calls. I also saw one branch improve slightly, which makes me think execution differs by team.\n\nReply (Alex): We should separate the change itself from training. The checklist wasnâ€™t shared with new hires. Instead letâ€™s run a short refresher session and compare results over two weeks before we reverse the decision.","question":"Which statement best expresses the main idea of the passage?","choices":["The passage is mainly about replacing all staff with automation.","The passage argues that financial profit is the only meaningful goal.","The organization is using evidence and feedback to decide how to proceed with a recent change.","The passage explains the history of a river system in detail."],"answer":2,"evidence":"From: Maya To: Project group Iâ€™m concerned that response time has worsened since we paused a new policy."},{"id":28,"genre":"education_training","style":"case_study","qtype":"tone","passage":"Case study: Turning around response time\n\nWhen a logistics firm noticed declining attendance, it phased in an internal tool for a three-month trial. Teams received a short guide and a single target. Results were limited: the best sites improved response time initially, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. Nevertheless the company revised the guide with concrete examples and removed optional steps. On the other hand leaders plan to scale the approach only after confirming the same gains in a second region.","question":"Which word best describes the tone of the passage?","choices":["sarcastic","cautious","furious","playful"],"answer":1,"evidence":"nevertheless the company revised the guide with concrete examples and removed optional steps."},{"id":29,"genre":"science_general","style":"news_article","qtype":"best_title","passage":"A public agency has phased in a pricing change over the past year, aiming to address customer churn.\n\nEarly figures show mixed results: error rate improved gradually in some locations, but changed little in others. Managers say the biggest obstacle is consistencyâ€”local teams interpret the guidance differently, and some lack the tools to track outcomes. Moreover, analysts caution that short-term data can be misleading because seasonal demand distorts comparisons. On the other hand, the organization plans to keep the trial running and publish clearer benchmarks before deciding on a wider rollout.","question":"Which title best fits the passage?","choices":["A Guide to Cooking for Large Events","How to Build a Keyboard From Scratch","A Trial Program Shows Why Consistency Matters","Ten Beaches to Visit This Summer"],"answer":2,"evidence":"Early figures show mixed results: error rate improved gradually in some locations, but changed little in others."},{"id":30,"genre":"science_general","style":"email_thread","qtype":"reference","passage":"From: Maya To: Project group Iâ€™m concerned that complaint volume has worsened since we tested a new policy. Several customers mentioned customer churn in their last calls. I also saw one branch improve gradually, which makes me think execution differs by team.\n\nReply (Alex): We should separate the change itself from training. The checklist wasnâ€™t shared with new hires. Moreover letâ€™s run a short refresher session and compare results over two weeks before we reverse the decision. Overall, it will be judged against longer-term trends rather than a single week.","question":"In the passage, the word 'it' most likely refers to what?","choices":["the trial","the weather","the Atlantic Ocean","the equator"],"answer":0,"evidence":"Overall, it will be judged against longer-term trends rather than a single week."},{"id":31,"genre":"customer_service","style":"meeting_minutes","qtype":"inference","passage":"Minutes: Weekly review\n1) Background: a software startup has been dealing with customer churn.\n2) Data: error rate improved only at sites that used the updated checklist; other sites showed no change.\n3) Discussion: Some members argued the trial was too short, while others pointed to complaints as an early warning sign. On the other hand, the group agreed that the next step is to standardize reporting so results can be compared fairly.\n4) Decision: Continue a service upgrade for one more cycle and revisit the plan with clearer evidence.","question":"What can be inferred from the passage?","choices":["The passage states that costs will definitely fall next month.","The organization has decided to cancel the initiative immediately.","The initiative has already been proven successful everywhere.","The organization is continuing the initiative while refining how it is implemented."],"answer":3,"evidence":"4) Decision: Continue a service upgrade for one more cycle and revisit the plan with clearer evidence."},{"id":32,"genre":"operations_logistics","style":"internal_memo","qtype":"best_title","passage":"To: All staff\nSubject: Update on an internal tool\n\nWe have announced an internal tool in the last six months in response to staff fatigue. Please note that the goal is not to maximize output at any cost; it is to improve response time without increasing risk. If you notice confusion about responsibilities, flag it to your lead immediately. That said, do not assume that a single good week proves the change is working. Meanwhile, we will review results after the next reporting cycle and adjust the guidelines where needed.","question":"Which title best fits the passage?","choices":["How to Build a Keyboard From Scratch","Measuring Success Beyond Short-Term Numbers","A Guide to Cooking for Large Events","Ten Beaches to Visit This Summer"],"answer":1,"evidence":"To: All staff  Subject: Update on an internal tool   We have announced an internal tool in the last six months in response to staff fatigue."},{"id":33,"genre":"customer_service","style":"case_study","qtype":"main_idea","passage":"Case study: Turning around complaint volume\n\nWhen a mid-sized manufacturer noticed declining attendance, it expanded a pilot program for a three-month trial. Teams received a short guide and a single target. Results were surprising: the best sites improved complaint volume slightly, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. On the other hand the company revised the guide with concrete examples and removed optional steps. Nevertheless leaders plan to scale the approach only after confirming the same gains in a second region.","question":"Which statement best expresses the main idea of the passage?","choices":["The passage explains the history of a river system in detail.","The passage is mainly about replacing all staff with automation.","Results depend on implementation details, so clearer guidelines and measurement are needed.","The passage argues that financial profit is the only meaningful goal."],"answer":2,"evidence":"Results were surprising: the best sites improved complaint volume slightly, while the weakest sites barely moved."},{"id":34,"genre":"environment","style":"report_summary","qtype":"reference","passage":"Summary report Objective: reduce data privacy concerns and improve energy use.\n\nMethod: tested a reporting system during a three-month trial across multiple sites. Findings: outcomes were surprising. Sites with clear ownership improved energy use gradually; sites with frequent staff changes did not. So qualitative feedback suggests the instructions were interpreted inconsistently. The recommendation is to refine the guidance, retrain affected teams, and reassess after the next cycle. Overall, it will be judged against longer-term trends rather than a single week.","question":"In the passage, the word 'it' most likely refers to what?","choices":["the Atlantic Ocean","the equator","the trial","the weather"],"answer":2,"evidence":"Overall, it will be judged against longer-term trends rather than a single week."},{"id":35,"genre":"science_general","style":"news_article","qtype":"inference","passage":"A regional bank has standardized a pilot program during a three-month trial, aiming to address staff fatigue.\n\nEarly figures show mixed results: retention improved only in some locations, but changed little in others. Managers say the biggest obstacle is consistencyâ€”local teams interpret the guidance differently, and some lack the tools to track outcomes. Nevertheless, analysts caution that short-term data can be misleading because seasonal demand distorts comparisons. Consequently, the organization plans to keep the trial running and publish clearer benchmarks before deciding on a wider rollout.","question":"What can be inferred from the passage?","choices":["The organization is continuing the initiative while refining how it is implemented.","The initiative has already been proven successful everywhere.","The organization has decided to cancel the initiative immediately.","The passage states that costs will definitely fall next month."],"answer":0,"evidence":"Early figures show mixed results: retention improved only in some locations, but changed little in others."},{"id":36,"genre":"education_training","style":"interview_qna","qtype":"main_idea","passage":"Q: Why did you expand an internal tool?\nA: We needed a practical response to declining attendance. We werenâ€™t looking for a miracle; we wanted stable gains in error rate.\n\nQ: Did it work?\nA: The picture is surprising. Some teams improved gradually, but others struggled because they lacked shared definitions. Instead we learned that the change requires coaching, not just an announcement. Weâ€™ll adjust the plan and continue collecting data before making a final decision.","question":"Which statement best expresses the main idea of the passage?","choices":["A new initiative shows uneven results, and the next step is to improve consistency before scaling.","The passage argues that financial profit is the only meaningful goal.","The passage explains the history of a river system in detail.","The passage is mainly about replacing all staff with automation."],"answer":0,"evidence":"Q: Why did you expand an internal tool?"},{"id":37,"genre":"operations_logistics","style":"meeting_minutes","qtype":"best_title","passage":"Minutes: Weekly review\n1) Background: a public agency has been dealing with declining attendance.\n2) Data: response time improved only at sites that used the updated checklist; other sites showed no change.\n3) Discussion: Some members argued the trial was too short, while others pointed to complaints as an early warning sign. In addition, the group agreed that the next step is to standardize reporting so results can be compared fairly.\n4) Decision: Continue a pilot program for one more cycle and revisit the plan with clearer evidence.","question":"Which title best fits the passage?","choices":["A Trial Program Shows Why Consistency Matters","A Guide to Cooking for Large Events","Ten Beaches to Visit This Summer","How to Build a Keyboard From Scratch"],"answer":0,"evidence":"Minutes: Weekly review  1) Background: a public agency has been dealing with declining attendance."},{"id":38,"genre":"finance","style":"case_study","qtype":"main_idea","passage":"Case study: Turning around error rate\n\nWhen a university noticed customer churn, it phased in a pricing change for a three-month trial. Teams received a short guide and a single target. Results were encouraging: the best sites improved error rate initially, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. For instance the company revised the guide with concrete examples and removed optional steps. Yet leaders plan to scale the approach only after confirming the same gains in a second region.","question":"Which statement best expresses the main idea of the passage?","choices":["The passage is mainly about replacing all staff with automation.","The passage argues that financial profit is the only meaningful goal.","A new initiative shows uneven results, and the next step is to improve consistency before scaling.","The passage explains the history of a river system in detail."],"answer":2,"evidence":"Case study: Turning around error rate   When a university noticed customer churn, it phased in a pricing change for a three-month trial."},{"id":39,"genre":"science_general","style":"report_summary","qtype":"reference","passage":"Summary report Objective: reduce data privacy concerns and improve revenue per user.\n\nMethod: paused a service upgrade this quarter across multiple sites. Findings: outcomes were limited. Sites with clear ownership improved revenue per user slightly; sites with frequent staff changes did not. Instead qualitative feedback suggests the instructions were interpreted inconsistently. Meanwhile the recommendation is to refine the guidance, retrain affected teams, and reassess after the next cycle. Overall, it will be judged against longer-term trends rather than a single week.","question":"In the passage, the word 'it' most likely refers to what?","choices":["the trial","the Atlantic Ocean","the equator","the weather"],"answer":0,"evidence":"Overall, it will be judged against longer-term trends rather than a single week."},{"id":40,"genre":"operations_logistics","style":"case_study","qtype":"purpose","passage":"Case study: Turning around error rate\n\nWhen a public agency noticed delayed shipments, it phased in a pilot program for a three-month trial. Teams received a short guide and a single target. Results were mixed: the best sites improved error rate at first, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. The company revised the guide with concrete examples and removed optional steps. On the other hand leaders plan to scale the approach only after confirming the same gains in a second region.","question":"What is the primary purpose of the passage?","choices":["To advertise a product with limited stock.","To provide step-by-step technical instructions for installing software.","To describe a recent change and discuss how it is being evaluated.","To entertain readers with a fictional story."],"answer":2,"evidence":"Case study: Turning around error rate   When a public agency noticed delayed shipments, it phased in a pilot program for a three-month trial."},{"id":41,"genre":"hr_workplace","style":"report_summary","qtype":"best_title","passage":"Summary report Objective: reduce rising costs and improve error rate.\n\nMethod: announced a service upgrade after the holiday season across multiple sites. Findings: outcomes were steady. Sites with clear ownership improved error rate initially; sites with frequent staff changes did not. In contrast qualitative feedback suggests the instructions were interpreted inconsistently. Meanwhile the recommendation is to refine the guidance, retrain affected teams, and reassess after the next cycle.","question":"Which title best fits the passage?","choices":["Ten Beaches to Visit This Summer","Measuring Success Beyond Short-Term Numbers","How to Build a Keyboard From Scratch","A Guide to Cooking for Large Events"],"answer":1,"evidence":"Summary report Objective: reduce rising costs and improve error rate."},{"id":42,"genre":"finance","style":"news_article","qtype":"purpose","passage":"A regional bank has announced a new policy this quarter, aiming to address data privacy concerns.\n\nEarly figures show limited results: revenue per user improved noticeably in some locations, but changed little in others. Managers say the biggest obstacle is consistencyâ€”local teams interpret the guidance differently, and some lack the tools to track outcomes. On the other hand, analysts caution that short-term data can be misleading because seasonal demand distorts comparisons. The organization plans to keep the trial running and publish clearer benchmarks before deciding on a wider rollout.","question":"What is the primary purpose of the passage?","choices":["To advertise a product with limited stock.","To provide step-by-step technical instructions for installing software.","To entertain readers with a fictional story.","To report mixed outcomes and recommend next steps."],"answer":3,"evidence":"A regional bank has announced a new policy this quarter, aiming to address data privacy concerns."},{"id":43,"genre":"science_general","style":"meeting_minutes","qtype":"main_idea","passage":"Minutes: Weekly review\n1) Background: a software startup has been dealing with delayed shipments.\n2) Data: complaint volume improved at first at sites that used the updated checklist; other sites showed no change.\n3) Discussion: Some members argued the trial was too short, while others pointed to complaints as an early warning sign. Meanwhile, the group agreed that the next step is to standardize reporting so results can be compared fairly.\n4) Decision: Continue a pilot program for one more cycle and revisit the plan with clearer evidence.","question":"Which statement best expresses the main idea of the passage?","choices":["The passage argues that financial profit is the only meaningful goal.","The passage is mainly about replacing all staff with automation.","The organization is using evidence and feedback to decide how to proceed with a recent change.","The passage explains the history of a river system in detail."],"answer":2,"evidence":"Minutes: Weekly review  1) Background: a software startup has been dealing with delayed shipments."},{"id":44,"genre":"environment","style":"case_study","qtype":"purpose","passage":"Case study: Turning around complaint volume\n\nWhen a university noticed system outages, it introduced a training series for a three-month trial. Teams received a short guide and a single target. Results were mixed: the best sites improved complaint volume at first, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. Meanwhile the company revised the guide with concrete examples and removed optional steps. Leaders plan to scale the approach only after confirming the same gains in a second region.","question":"What is the primary purpose of the passage?","choices":["To report mixed outcomes and recommend next steps.","To provide step-by-step technical instructions for installing software.","To advertise a product with limited stock.","To entertain readers with a fictional story."],"answer":0,"evidence":"Case study: Turning around complaint volume   When a university noticed system outages, it introduced a training series for a three-month trial."},{"id":45,"genre":"business_strategy","style":"op_ed","qtype":"tone","passage":"It is tempting to declare a pilot program a success the moment on-time delivery ticks upward.\n\nThat temptation is exactly what undermines good decisions.\n\nIn my view, a retail chain has treated rising costs as a problem of effort rather than design.\n\nPeople work harder, outcomes wobble, and leadership calls it â€œprogress.â€ meanwhile real improvement comes from removing friction: clearer rules, better tools, and fewer exceptions. If the trial continues, it should be evaluated against a baseline, not against last weekâ€™s mood.","question":"Which word best describes the tone of the passage?","choices":["playful","analytical","sarcastic","furious"],"answer":1,"evidence":"It is tempting to declare a pilot program a success the moment on-time delivery ticks upward."},{"id":46,"genre":"science_general","style":"case_study","qtype":"best_title","passage":"Case study: Turning around energy use\n\nWhen a retail chain noticed declining attendance, it expanded a new policy for a three-month trial. Teams received a short guide and a single target. Results were surprising: the best sites improved energy use noticeably, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. That said the company revised the guide with concrete examples and removed optional steps. For instance leaders plan to scale the approach only after confirming the same gains in a second region.","question":"Which title best fits the passage?","choices":["Ten Beaches to Visit This Summer","A Guide to Cooking for Large Events","Mixed Results Lead to Refinement, Not Retreat","How to Build a Keyboard From Scratch"],"answer":2,"evidence":"Case study: Turning around energy use   When a retail chain noticed declining attendance, it expanded a new policy for a three-month trial."},{"id":47,"genre":"environment","style":"report_summary","qtype":"purpose","passage":"Summary report Objective: reduce declining attendance and improve customer satisfaction.\n\nMethod: tested a maintenance schedule after the holiday season across multiple sites. Findings: outcomes were mixed. Sites with clear ownership improved customer satisfaction only; sites with frequent staff changes did not. Also qualitative feedback suggests the instructions were interpreted inconsistently. The recommendation is to refine the guidance, retrain affected teams, and reassess after the next cycle.","question":"What is the primary purpose of the passage?","choices":["To entertain readers with a fictional story.","To report mixed outcomes and recommend next steps.","To advertise a product with limited stock.","To provide step-by-step technical instructions for installing software."],"answer":1,"evidence":"Summary report Objective: reduce declining attendance and improve customer satisfaction."},{"id":48,"genre":"education_training","style":"op_ed","qtype":"tone","passage":"It is tempting to declare a new policy a success the moment revenue per user ticks upward.\n\nThat temptation is exactly what undermines good decisions.\n\nIn my view, a mid-sized manufacturer has treated declining attendance as a problem of effort rather than design.\n\nPeople work harder, outcomes wobble, and leadership calls it â€œprogress.â€ on the other hand real improvement comes from removing friction: clearer rules, better tools, and fewer exceptions. If the trial continues, it should be evaluated against a baseline, not against last weekâ€™s mood.","question":"Which word best describes the tone of the passage?","choices":["sarcastic","playful","furious","cautious"],"answer":3,"evidence":"It is tempting to declare a new policy a success the moment revenue per user ticks upward."},{"id":49,"genre":"environment","style":"meeting_minutes","qtype":"main_idea","passage":"Minutes: Weekly review\n1) Background: a university has been dealing with customer churn.\n2) Data: customer satisfaction improved initially at sites that used the updated checklist; other sites showed no change.\n3) Discussion: Some members argued the trial was too short, while others pointed to complaints as an early warning sign. Consequently, the group agreed that the next step is to standardize reporting so results can be compared fairly.\n4) Decision: Continue an internal tool for one more cycle and revisit the plan with clearer evidence.","question":"Which statement best expresses the main idea of the passage?","choices":["The organization is using evidence and feedback to decide how to proceed with a recent change.","The passage explains the history of a river system in detail.","The passage argues that financial profit is the only meaningful goal.","The passage is mainly about replacing all staff with automation."],"answer":0,"evidence":"Minutes: Weekly review 1) Background: a university has been dealing with customer churn."},{"id":50,"genre":"business_strategy","style":"news_article","qtype":"inference","passage":"A logistics firm has paused a pilot program over the past year, aiming to address staff fatigue.\n\nEarly figures show surprising results: complaint volume improved slightly in some locations, but changed little in others. Managers say the biggest obstacle is consistencyâ€”local teams interpret the guidance differently, and some lack the tools to track outcomes. Nevertheless, analysts caution that short-term data can be misleading because seasonal demand distorts comparisons. As a result, the organization plans to keep the trial running and publish clearer benchmarks before deciding on a wider rollout.","question":"What can be inferred from the passage?","choices":["The passage states that costs will definitely fall next month.","Short-term data alone may not be enough to judge whether the change works.","The organization has decided to cancel the initiative immediately.","The initiative has already been proven successful everywhere."],"answer":1,"evidence":"nevertheless, analysts caution that short-term data can be misleading because seasonal demand distorts comparisons."},{"id":51,"genre":"health","style":"op_ed","qtype":"best_title","passage":"It is tempting to declare a maintenance schedule a success the moment customer satisfaction ticks upward.\n\nThat temptation is exactly what undermines good decisions.\n\nIn my view, a university has treated traffic congestion as a problem of effort rather than design.\n\nPeople work harder, outcomes wobble, and leadership calls it â€œprogress.â€ by comparison real improvement comes from removing friction: clearer rules, better tools, and fewer exceptions.\n\nYet if the trial continues, it should be evaluated against a baseline, not against last weekâ€™s mood.","question":"Which title best fits the passage?","choices":["Measuring Success Beyond Short-Term Numbers","A Guide to Cooking for Large Events","Ten Beaches to Visit This Summer","How to Build a Keyboard From Scratch"],"answer":0,"evidence":"It is tempting to declare a maintenance schedule a success the moment customer satisfaction ticks upward."},{"id":52,"genre":"business_strategy","style":"report_summary","qtype":"inference","passage":"Summary report Objective: reduce rising costs and improve complaint volume.\n\nMethod: introduced a new policy after the holiday season across multiple sites. Findings: outcomes were limited. Sites with clear ownership improved complaint volume slightly; sites with frequent staff changes did not. Qualitative feedback suggests the instructions were interpreted inconsistently. On the other hand the recommendation is to refine the guidance, retrain affected teams, and reassess after the next cycle.","question":"What can be inferred from the passage?","choices":["The passage states that costs will definitely fall next month.","The initiative has already been proven successful everywhere.","The organization has decided to cancel the initiative immediately.","The organization is continuing the initiative while refining how it is implemented."],"answer":3,"evidence":"Findings: outcomes were limited."},{"id":53,"genre":"society_culture","style":"op_ed","qtype":"tone","passage":"It is tempting to declare a training series a success the moment error rate ticks upward.\n\nThat temptation is exactly what undermines good decisions.\n\nIn my view, a regional bank has treated system outages as a problem of effort rather than design.\n\nPeople work harder, outcomes wobble, and leadership calls it â€œprogress.â€ real improvement comes from removing friction: clearer rules, better tools, and fewer exceptions. Also if the trial continues, it should be evaluated against a baseline, not against last weekâ€™s mood.","question":"Which word best describes the tone of the passage?","choices":["cautious","furious","playful","sarcastic"],"answer":0,"evidence":"It is tempting to declare a training series a success the moment error rate ticks upward."},{"id":54,"genre":"customer_service","style":"meeting_minutes","qtype":"inference","passage":"Minutes: Weekly review\n1) Background: a public agency has been dealing with customer churn.\n2) Data: customer satisfaction improved at first at sites that used the updated checklist; other sites showed no change.\n3) Discussion: Some members argued the trial was too short, while others pointed to complaints as an early warning sign. For instance, the group agreed that the next step is to standardize reporting so results can be compared fairly.\n4) Decision: Continue a pilot program for one more cycle and revisit the plan with clearer evidence.","question":"What can be inferred from the passage?","choices":["The passage states that costs will definitely fall next month.","The organization is continuing the initiative while refining how it is implemented.","The initiative has already been proven successful everywhere.","The organization has decided to cancel the initiative immediately."],"answer":1,"evidence":"4) Decision: Continue a pilot program for one more cycle and revisit the plan with clearer evidence."},{"id":55,"genre":"environment","style":"meeting_minutes","qtype":"inference","passage":"Minutes: Weekly review\n1) Background: a retail chain has been dealing with staff fatigue.\n2) Data: on-time delivery improved initially at sites that used the updated checklist; other sites showed no change.\n3) Discussion: Some members argued the trial was too short, while others pointed to complaints as an early warning sign. So, the group agreed that the next step is to standardize reporting so results can be compared fairly.\n4) Decision: Continue a maintenance schedule for one more cycle and revisit the plan with clearer evidence.","question":"What can be inferred from the passage?","choices":["Differences in execution across sites are affecting the results.","The initiative has already been proven successful everywhere.","The organization has decided to cancel the initiative immediately.","The passage states that costs will definitely fall next month."],"answer":0,"evidence":"2) Data: on-time delivery improved initially at sites that used the updated checklist; other sites showed no change."},{"id":56,"genre":"health","style":"meeting_minutes","qtype":"inference","passage":"Minutes: Weekly review\n1) Background: a university has been dealing with declining attendance.\n2) Data: complaint volume improved gradually at sites that used the updated checklist; other sites showed no change.\n3) Discussion: Some members argued the trial was too short, while others pointed to complaints as an early warning sign. On the other hand, the group agreed that the next step is to standardize reporting so results can be compared fairly.\n4) Decision: Continue a maintenance schedule for one more cycle and revisit the plan with clearer evidence.","question":"What can be inferred from the passage?","choices":["The organization is continuing the initiative while refining how it is implemented.","The initiative has already been proven successful everywhere.","The organization has decided to cancel the initiative immediately.","The passage states that costs will definitely fall next month."],"answer":0,"evidence":"4) Decision: Continue a maintenance schedule for one more cycle and revisit the plan with clearer evidence."},{"id":57,"genre":"business_strategy","style":"internal_memo","qtype":"main_idea","passage":"To: All staff\nSubject: Update on a service upgrade\n\nWe have announced a service upgrade in the last six months in response to data privacy concerns. Please note that the goal is not to maximize output at any cost; it is to improve response time without increasing risk. If you notice confusion about responsibilities, flag it to your lead immediately. Consequently, do not assume that a single good week proves the change is working. So, we will review results after the next reporting cycle and adjust the guidelines where needed.","question":"Which statement best expresses the main idea of the passage?","choices":["The passage argues that financial profit is the only meaningful goal.","Results depend on implementation details, so clearer guidelines and measurement are needed.","The passage is mainly about replacing all staff with automation.","The passage explains the history of a river system in detail."],"answer":1,"evidence":"so, we will review results after the next reporting cycle and adjust the guidelines where needed."},{"id":58,"genre":"hr_workplace","style":"email_thread","qtype":"purpose","passage":"From: Maya To: Project group Iâ€™m concerned that error rate has worsened since we introduced an internal tool. Several customers mentioned staff fatigue in their last calls. I also saw one branch improve initially, which makes me think execution differs by team.\n\nReply (Alex): We should separate the change itself from training. The checklist wasnâ€™t shared with new hires. So letâ€™s run a short refresher session and compare results over two weeks before we reverse the decision.","question":"What is the primary purpose of the passage?","choices":["To advertise a product with limited stock.","To report mixed outcomes and recommend next steps.","To provide step-by-step technical instructions for installing software.","To entertain readers with a fictional story."],"answer":1,"evidence":"From: Maya To: Project group Iâ€™m concerned that error rate has worsened since we introduced an internal tool."},{"id":59,"genre":"education_training","style":"internal_memo","qtype":"reference","passage":"To: All staff\nSubject: Update on a training series\n\nWe have introduced a training series since early spring in response to staff fatigue. Please note that the goal is not to maximize output at any cost; it is to improve customer satisfaction without increasing risk. If you notice confusion about responsibilities, flag it to your lead immediately. Meanwhile, do not assume that a single good week proves the change is working. For instance, we will review results after the next reporting cycle and adjust the guidelines where needed.","question":"In the passage, the word 'it' most likely refers to what?","choices":["the initiative","the weather","the Atlantic Ocean","the equator"],"answer":0,"evidence":"To: All staff Subject: Update on a training series We have introduced a training series since early spring in response to staff fatigue. Please note that the goal is not to maximize output at any cost; it is to improve customer satisfaction without increasing risk."},{"id":60,"genre":"education_training","style":"interview_qna","qtype":"best_title","passage":"Q: Why did you introduc a reporting system?\nA: We needed a practical response to delayed shipments. We werenâ€™t looking for a miracle; we wanted stable gains in on-time delivery.\n\nQ: Did it work?\nA: The picture is mixed. Some teams improved initially, but others struggled because they lacked shared definitions. Meanwhile we learned that the change requires coaching, not just an announcement. For instance weâ€™ll adjust the plan and continue collecting data before making a final decision.","question":"Which title best fits the passage?","choices":["How to Build a Keyboard From Scratch","Measuring Success Beyond Short-Term Numbers","Ten Beaches to Visit This Summer","A Guide to Cooking for Large Events"],"answer":1,"evidence":"Q: Why did you introduc a reporting system?"},{"id":61,"genre":"customer_service","style":"meeting_minutes","qtype":"tone","passage":"Minutes: Weekly review\n1) Background: a mid-sized manufacturer has been dealing with traffic congestion.\n2) Data: complaint volume improved only at sites that used the updated checklist; other sites showed no change.\n3) Discussion: Some members argued the trial was too short, while others pointed to complaints as an early warning sign. By comparison, the group agreed that the next step is to standardize reporting so results can be compared fairly.\n4) Decision: Continue a service upgrade for one more cycle and revisit the plan with clearer evidence.","question":"Which word best describes the tone of the passage?","choices":["measured","furious","playful","sarcastic"],"answer":0,"evidence":"Minutes: Weekly review 1) Background: a mid-sized manufacturer has been dealing with traffic congestion."},{"id":62,"genre":"technology","style":"case_study","qtype":"best_title","passage":"Case study: Turning around revenue per user\n\nWhen a retail chain noticed staff fatigue, it revised a pricing change for a three-month trial. Teams received a short guide and a single target. Results were steady: the best sites improved revenue per user at first, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. Furthermore the company revised the guide with concrete examples and removed optional steps. So leaders plan to scale the approach only after confirming the same gains in a second region.","question":"Which title best fits the passage?","choices":["Mixed Results Lead to Refinement, Not Retreat","How to Build a Keyboard From Scratch","A Guide to Cooking for Large Events","Ten Beaches to Visit This Summer"],"answer":0,"evidence":"Case study: Turning around revenue per user   When a retail chain noticed staff fatigue, it revised a pricing change for a three-month trial."},{"id":63,"genre":"finance","style":"internal_memo","qtype":"inference","passage":"To: All staff\nSubject: Update on an internal tool\n\nWe have tested an internal tool since early spring in response to customer churn. Please note that the goal is not to maximize output at any cost; it is to improve on-time delivery without increasing risk. If you notice confusion about responsibilities, flag it to your lead immediately. On the other hand, do not assume that a single good week proves the change is working. Nevertheless, we will review results after the next reporting cycle and adjust the guidelines where needed.","question":"What can be inferred from the passage?","choices":["The organization has decided to cancel the initiative immediately.","The initiative has already been proven successful everywhere.","The organization is continuing the initiative while refining how it is implemented.","The passage states that costs will definitely fall next month."],"answer":2,"evidence":"nevertheless, we will review results after the next reporting cycle and adjust the guidelines where needed."},{"id":64,"genre":"travel_transport","style":"email_thread","qtype":"inference","passage":"From: Maya To: Project group Iâ€™m concerned that on-time delivery has worsened since we announced a maintenance schedule. Several customers mentioned traffic congestion in their last calls. Meanwhile I also saw one branch improve at first, which makes me think execution differs by team.\n\nReply (Alex): We should separate the change itself from training. The checklist wasnâ€™t shared with new hires. Letâ€™s run a short refresher session and compare results over two weeks before we reverse the decision.","question":"What can be inferred from the passage?","choices":["The organization has decided to cancel the initiative immediately.","The organization is continuing the initiative while refining how it is implemented.","The initiative has already been proven successful everywhere.","The passage states that costs will definitely fall next month."],"answer":1,"evidence":"meanwhile I also saw one branch improve at first, which makes me think execution differs by team."},{"id":65,"genre":"customer_service","style":"internal_memo","qtype":"tone","passage":"To: All staff\nSubject: Update on an internal tool\n\nWe have paused an internal tool after the holiday season in response to traffic congestion. Please note that the goal is not to maximize output at any cost; it is to improve response time without increasing risk. If you notice confusion about responsibilities, flag it to your lead immediately. Meanwhile, do not assume that a single good week proves the change is working. On the other hand, we will review results after the next reporting cycle and adjust the guidelines where needed.","question":"Which word best describes the tone of the passage?","choices":["cautious","furious","playful","sarcastic"],"answer":0,"evidence":"meanwhile, do not assume that a single good week proves the change is working."},{"id":66,"genre":"operations_logistics","style":"news_article","qtype":"reference","passage":"A logistics firm has standardized a maintenance schedule over the past year, aiming to address rising costs.\n\nEarly figures show uneven results: complaint volume improved slightly in some locations, but changed little in others. Managers say the biggest obstacle is consistencyâ€”local teams interpret the guidance differently, and some lack the tools to track outcomes. Meanwhile, analysts caution that short-term data can be misleading because seasonal demand distorts comparisons. Still, the organization plans to keep the trial running and publish clearer benchmarks before deciding on a wider rollout. Overall, it will be judged against longer-term trends rather than a single week.","question":"In the passage, the word 'it' most likely refers to what?","choices":["the Atlantic Ocean","the weather","the equator","the new policy"],"answer":3,"evidence":"Overall, it will be judged against longer-term trends rather than a single week."},{"id":67,"genre":"environment","style":"case_study","qtype":"inference","passage":"Case study: Turning around energy use\n\nWhen a logistics firm noticed declining attendance, it phased in a new policy for a three-month trial. Teams received a short guide and a single target. Results were surprising: the best sites improved energy use slightly, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. Conversely the company revised the guide with concrete examples and removed optional steps. Leaders plan to scale the approach only after confirming the same gains in a second region.","question":"What can be inferred from the passage?","choices":["The initiative has already been proven successful everywhere.","The passage states that costs will definitely fall next month.","Short-term data alone may not be enough to judge whether the change works.","The organization has decided to cancel the initiative immediately."],"answer":2,"evidence":"Results were surprising: the best sites improved energy use slightly, while the weakest sites barely moved."},{"id":68,"genre":"society_culture","style":"report_summary","qtype":"tone","passage":"Summary report Objective: reduce rising costs and improve retention.\n\nMethod: standardized a maintenance schedule after the holiday season across multiple sites. Findings: outcomes were steady. Sites with clear ownership improved retention at first; sites with frequent staff changes did not. On the other hand qualitative feedback suggests the instructions were interpreted inconsistently. Conversely the recommendation is to refine the guidance, retrain affected teams, and reassess after the next cycle.","question":"Which word best describes the tone of the passage?","choices":["measured","sarcastic","furious","playful"],"answer":0,"evidence":"Summary report Objective: reduce rising costs and improve retention."},{"id":69,"genre":"society_culture","style":"interview_qna","qtype":"reference","passage":"Q: Why did you phas in a pricing change?\nA: We needed a practical response to delayed shipments. We werenâ€™t looking for a miracle; we wanted stable gains in complaint volume.\n\nQ: Did it work?\nA: The picture is limited. Some teams improved slightly, but others struggled because they lacked shared definitions. Conversely we learned that the change requires coaching, not just an announcement. Meanwhile weâ€™ll adjust the plan and continue collecting data before making a final decision.","question":"In the passage, the word 'it' most likely refers to what?","choices":["the weather","the equator","the Atlantic Ocean","the initiative"],"answer":3,"evidence":"We werenâ€™t looking for a miracle; we wanted stable gains in complaint volume. Q: Did it work?"},{"id":70,"genre":"business_strategy","style":"internal_memo","qtype":"tone","passage":"To: All staff\nSubject: Update on a pricing change\n\nWe have expanded a pricing change since early spring in response to declining attendance. Please note that the goal is not to maximize output at any cost; it is to improve retention without increasing risk. If you notice confusion about responsibilities, flag it to your lead immediately. Meanwhile, do not assume that a single good week proves the change is working. Nevertheless, we will review results after the next reporting cycle and adjust the guidelines where needed.","question":"Which word best describes the tone of the passage?","choices":["sarcastic","analytical","playful","furious"],"answer":1,"evidence":"meanwhile, do not assume that a single good week proves the change is working."},{"id":71,"genre":"technology","style":"report_summary","qtype":"purpose","passage":"Summary report Objective: reduce system outages and improve customer satisfaction.\n\nMethod: revised a service upgrade after the holiday season across multiple sites. Findings: outcomes were limited. Sites with clear ownership improved customer satisfaction noticeably; sites with frequent staff changes did not. On the other hand qualitative feedback suggests the instructions were interpreted inconsistently. That said the recommendation is to refine the guidance, retrain affected teams, and reassess after the next cycle.","question":"What is the primary purpose of the passage?","choices":["To entertain readers with a fictional story.","To advertise a product with limited stock.","To provide step-by-step technical instructions for installing software.","To explain why a trial is continuing despite criticism."],"answer":3,"evidence":"Summary report Objective: reduce system outages and improve customer satisfaction."},{"id":72,"genre":"hr_workplace","style":"case_study","qtype":"best_title","passage":"Case study: Turning around error rate\n\nWhen a retail chain noticed customer churn, it expanded a training series for a three-month trial. Teams received a short guide and a single target. Results were encouraging: the best sites improved error rate noticeably, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. On the other hand the company revised the guide with concrete examples and removed optional steps. In contrast leaders plan to scale the approach only after confirming the same gains in a second region.","question":"Which title best fits the passage?","choices":["Ten Beaches to Visit This Summer","A Trial Program Shows Why Consistency Matters","A Guide to Cooking for Large Events","How to Build a Keyboard From Scratch"],"answer":1,"evidence":"Case study: Turning around error rate When a retail chain noticed customer churn, it expanded a training series for a three-month trial."},{"id":73,"genre":"travel_transport","style":"interview_qna","qtype":"inference","passage":"Q: Why did you phas in an internal tool?\nA: We needed a practical response to delayed shipments. We werenâ€™t looking for a miracle; we wanted stable gains in retention.\n\nQ: Did it work?\nA: The picture is encouraging. Some teams improved only, but others struggled because they lacked shared definitions. Conversely we learned that the change requires coaching, not just an announcement. Moreover weâ€™ll adjust the plan and continue collecting data before making a final decision.","question":"What can be inferred from the passage?","choices":["The passage states that costs will definitely fall next month.","The organization has decided to cancel the initiative immediately.","Differences in execution across sites are affecting the results.","The initiative has already been proven successful everywhere."],"answer":2,"evidence":"moreover weâ€™ll adjust the plan and continue collecting data before making a final decision."},{"id":74,"genre":"science_general","style":"interview_qna","qtype":"purpose","passage":"Q: Why did you announc an internal tool?\nA: We needed a practical response to staff fatigue. We werenâ€™t looking for a miracle; we wanted stable gains in response time.\n\nQ: Did it work?\nA: The picture is steady. Some teams improved noticeably, but others struggled because they lacked shared definitions. On the other hand we learned that the change requires coaching, not just an announcement. Nevertheless weâ€™ll adjust the plan and continue collecting data before making a final decision.","question":"What is the primary purpose of the passage?","choices":["To provide step-by-step technical instructions for installing software.","To explain why a trial is continuing despite criticism.","To entertain readers with a fictional story.","To advertise a product with limited stock."],"answer":1,"evidence":"We werenâ€™t looking for a miracle; we wanted stable gains in response time."},{"id":75,"genre":"hr_workplace","style":"case_study","qtype":"inference","passage":"Case study: Turning around complaint volume\n\nWhen a public agency noticed data privacy concerns, it announced a service upgrade for a three-month trial. Teams received a short guide and a single target. Results were steady: the best sites improved complaint volume initially, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. The company revised the guide with concrete examples and removed optional steps. Meanwhile leaders plan to scale the approach only after confirming the same gains in a second region.","question":"What can be inferred from the passage?","choices":["The organization is continuing the initiative while refining how it is implemented.","The initiative has already been proven successful everywhere.","The organization has decided to cancel the initiative immediately.","The passage states that costs will definitely fall next month."],"answer":0,"evidence":"Results were steady: the best sites improved complaint volume initially, while the weakest sites barely moved."},{"id":76,"genre":"society_culture","style":"report_summary","qtype":"purpose","passage":"Summary report Objective: reduce rising costs and improve complaint volume.\n\nMethod: expanded a maintenance schedule in the last six months across multiple sites. Findings: outcomes were uneven. Sites with clear ownership improved complaint volume slightly; sites with frequent staff changes did not. By comparison qualitative feedback suggests the instructions were interpreted inconsistently. Nevertheless the recommendation is to refine the guidance, retrain affected teams, and reassess after the next cycle.","question":"What is the primary purpose of the passage?","choices":["To advertise a product with limited stock.","To provide step-by-step technical instructions for installing software.","To explain why a trial is continuing despite criticism.","To entertain readers with a fictional story."],"answer":2,"evidence":"Summary report Objective: reduce rising costs and improve complaint volume."},{"id":77,"genre":"technology","style":"report_summary","qtype":"best_title","passage":"Summary report Objective: reduce staff fatigue and improve on-time delivery.\n\nMethod: expanded a pilot program since early spring across multiple sites. Findings: outcomes were encouraging. Sites with clear ownership improved on-time delivery slightly; sites with frequent staff changes did not. Conversely qualitative feedback suggests the instructions were interpreted inconsistently. The recommendation is to refine the guidance, retrain affected teams, and reassess after the next cycle.","question":"Which title best fits the passage?","choices":["A Trial Program Shows Why Consistency Matters","Ten Beaches to Visit This Summer","How to Build a Keyboard From Scratch","A Guide to Cooking for Large Events"],"answer":0,"evidence":"Summary report Objective: reduce staff fatigue and improve on-time delivery."},{"id":78,"genre":"business_strategy","style":"interview_qna","qtype":"best_title","passage":"Q: Why did you introduc a training series?\nA: We needed a practical response to data privacy concerns. We werenâ€™t looking for a miracle; we wanted stable gains in error rate.\n\nQ: Did it work?\nA: The picture is steady. Some teams improved noticeably, but others struggled because they lacked shared definitions. That said we learned that the change requires coaching, not just an announcement. For instance weâ€™ll adjust the plan and continue collecting data before making a final decision.","question":"Which title best fits the passage?","choices":["Ten Beaches to Visit This Summer","A Guide to Cooking for Large Events","How to Build a Keyboard From Scratch","Mixed Results Lead to Refinement, Not Retreat"],"answer":3,"evidence":"Q: Why did you introduc a training series?"},{"id":79,"genre":"travel_transport","style":"case_study","qtype":"best_title","passage":"Case study: Turning around revenue per user\n\nWhen a university noticed declining attendance, it expanded a service upgrade for a three-month trial. Teams received a short guide and a single target. Results were encouraging: the best sites improved revenue per user initially, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. On the other hand the company revised the guide with concrete examples and removed optional steps. Also leaders plan to scale the approach only after confirming the same gains in a second region.","question":"Which title best fits the passage?","choices":["How to Build a Keyboard From Scratch","Ten Beaches to Visit This Summer","A Trial Program Shows Why Consistency Matters","A Guide to Cooking for Large Events"],"answer":2,"evidence":"Case study: Turning around revenue per user When a university noticed declining attendance, it expanded a service upgrade for a three-month trial."},{"id":80,"genre":"environment","style":"internal_memo","qtype":"purpose","passage":"To: All staff\nSubject: Update on an internal tool\n\nWe have paused an internal tool since early spring in response to system outages. Please note that the goal is not to maximize output at any cost; it is to improve retention without increasing risk. If you notice confusion about responsibilities, flag it to your lead immediately. On the other hand, do not assume that a single good week proves the change is working. Conversely, we will review results after the next reporting cycle and adjust the guidelines where needed.","question":"What is the primary purpose of the passage?","choices":["To entertain readers with a fictional story.","To describe a recent change and discuss how it is being evaluated.","To provide step-by-step technical instructions for installing software.","To advertise a product with limited stock."],"answer":1,"evidence":"To: All staff Subject: Update on an internal tool We have paused an internal tool since early spring in response to system outages."},{"id":81,"genre":"education_training","style":"news_article","qtype":"reference","passage":"A logistics firm has announced a new policy during a three-month trial, aiming to address customer churn.\n\nEarly figures show steady results: response time improved slightly in some locations, but changed little in others. Managers say the biggest obstacle is consistencyâ€”local teams interpret the guidance differently, and some lack the tools to track outcomes. Meanwhile, analysts caution that short-term data can be misleading because seasonal demand distorts comparisons. On the other hand, the organization plans to keep the trial running and publish clearer benchmarks before deciding on a wider rollout. Overall, it will be judged against longer-term trends rather than a single week.","question":"In the passage, the word 'it' most likely refers to what?","choices":["the Atlantic Ocean","the weather","the new policy","the equator"],"answer":2,"evidence":"Overall, it will be judged against longer-term trends rather than a single week."},{"id":82,"genre":"science_general","style":"case_study","qtype":"inference","passage":"Case study: Turning around retention\n\nWhen a software startup noticed data privacy concerns, it paused a pilot program for a three-month trial. Teams received a short guide and a single target. Results were surprising: the best sites improved retention initially, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. On the other hand the company revised the guide with concrete examples and removed optional steps. Conversely leaders plan to scale the approach only after confirming the same gains in a second region.","question":"What can be inferred from the passage?","choices":["The initiative has already been proven successful everywhere.","Short-term data alone may not be enough to judge whether the change works.","The organization has decided to cancel the initiative immediately.","The passage states that costs will definitely fall next month."],"answer":1,"evidence":"Case study: Turning around retention When a software startup noticed data privacy concerns, it paused a pilot program for a three-month trial."},{"id":83,"genre":"technology","style":"news_article","qtype":"tone","passage":"A mid-sized manufacturer has tested a training series after the holiday season, aiming to address customer churn.\n\nEarly figures show surprising results: on-time delivery improved at first in some locations, but changed little in others. Managers say the biggest obstacle is consistencyâ€”local teams interpret the guidance differently, and some lack the tools to track outcomes. Still, analysts caution that short-term data can be misleading because seasonal demand distorts comparisons. Moreover, the organization plans to keep the trial running and publish clearer benchmarks before deciding on a wider rollout.","question":"Which word best describes the tone of the passage?","choices":["playful","sarcastic","pragmatic","furious"],"answer":2,"evidence":"Early figures show surprising results: on-time delivery improved at first in some locations, but changed little in others."},{"id":84,"genre":"operations_logistics","style":"email_thread","qtype":"inference","passage":"From: Maya To: Project group Iâ€™m concerned that error rate has worsened since we standardized a training series. Several customers mentioned declining attendance in their last calls. However I also saw one branch improve noticeably, which makes me think execution differs by team.\n\nReply (Alex): We should separate the change itself from training. The checklist wasnâ€™t shared with new hires. So letâ€™s run a short refresher session and compare results over two weeks before we reverse the decision.","question":"What can be inferred from the passage?","choices":["The organization has decided to cancel the initiative immediately.","The passage states that costs will definitely fall next month.","Short-term data alone may not be enough to judge whether the change works.","The initiative has already been proven successful everywhere."],"answer":2,"evidence":"Reply (Alex): We should separate the change itself from training."},{"id":85,"genre":"health","style":"news_article","qtype":"reference","passage":"A regional bank has announced a training series over the past year, aiming to address customer churn.\n\nEarly figures show mixed results: complaint volume improved only in some locations, but changed little in others. Managers say the biggest obstacle is consistencyâ€”local teams interpret the guidance differently, and some lack the tools to track outcomes. As a result, analysts caution that short-term data can be misleading because seasonal demand distorts comparisons. On the other hand, the organization plans to keep the trial running and publish clearer benchmarks before deciding on a wider rollout. Overall, it will be judged against longer-term trends rather than a single week.","question":"In the passage, the word 'it' most likely refers to what?","choices":["the weather","the Atlantic Ocean","the equator","the change"],"answer":3,"evidence":"Overall, it will be judged against longer-term trends rather than a single week."},{"id":86,"genre":"technology","style":"case_study","qtype":"inference","passage":"Case study: Turning around error rate\n\nWhen a logistics firm noticed delayed shipments, it phased in a maintenance schedule for a three-month trial. Teams received a short guide and a single target. Results were mixed: the best sites improved error rate slightly, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. Meanwhile the company revised the guide with concrete examples and removed optional steps. That said leaders plan to scale the approach only after confirming the same gains in a second region.","question":"What can be inferred from the passage?","choices":["The organization has decided to cancel the initiative immediately.","The passage states that costs will definitely fall next month.","The initiative has already been proven successful everywhere.","Short-term data alone may not be enough to judge whether the change works."],"answer":3,"evidence":"Results were mixed: the best sites improved error rate slightly, while the weakest sites barely moved."},{"id":87,"genre":"operations_logistics","style":"interview_qna","qtype":"tone","passage":"Q: Why did you announc a reporting system?\nA: We needed a practical response to traffic congestion. We werenâ€™t looking for a miracle; we wanted stable gains in on-time delivery.\n\nQ: Did it work?\nA: The picture is mixed. Some teams improved gradually, but others struggled because they lacked shared definitions. Still we learned that the change requires coaching, not just an announcement. Weâ€™ll adjust the plan and continue collecting data before making a final decision.","question":"Which word best describes the tone of the passage?","choices":["sarcastic","playful","furious","cautious"],"answer":3,"evidence":"A: We needed a practical response to traffic congestion."},{"id":88,"genre":"customer_service","style":"op_ed","qtype":"best_title","passage":"It is tempting to declare a training series a success the moment retention ticks upward.\n\nThat temptation is exactly what undermines good decisions.\n\nIn my view, a retail chain has treated declining attendance as a problem of effort rather than design.\n\nPeople work harder, outcomes wobble, and leadership calls it â€œprogress.â€ meanwhile real improvement comes from removing friction: clearer rules, better tools, and fewer exceptions. Still if the trial continues, it should be evaluated against a baseline, not against last weekâ€™s mood.","question":"Which title best fits the passage?","choices":["Mixed Results Lead to Refinement, Not Retreat","A Guide to Cooking for Large Events","Ten Beaches to Visit This Summer","How to Build a Keyboard From Scratch"],"answer":0,"evidence":"It is tempting to declare a training series a success the moment retention ticks upward."},{"id":89,"genre":"travel_transport","style":"case_study","qtype":"tone","passage":"Case study: Turning around revenue per user\n\nWhen a software startup noticed rising costs, it expanded a pricing change for a three-month trial. Teams received a short guide and a single target. Results were uneven: the best sites improved revenue per user gradually, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. The company revised the guide with concrete examples and removed optional steps. On the other hand leaders plan to scale the approach only after confirming the same gains in a second region.","question":"Which word best describes the tone of the passage?","choices":["sarcastic","furious","pragmatic","playful"],"answer":2,"evidence":"Results were uneven: the best sites improved revenue per user gradually, while the weakest sites barely moved."},{"id":90,"genre":"operations_logistics","style":"op_ed","qtype":"inference","passage":"It is tempting to declare a new policy a success the moment response time ticks upward.\n\nThat temptation is exactly what undermines good decisions.\n\nIn my view, a public agency has treated customer churn as a problem of effort rather than design.\n\nPeople work harder, outcomes wobble, and leadership calls it â€œprogress.â€ on the other hand real improvement comes from removing friction: clearer rules, better tools, and fewer exceptions. So if the trial continues, it should be evaluated against a baseline, not against last weekâ€™s mood.","question":"What can be inferred from the passage?","choices":["The passage states that costs will definitely fall next month.","The organization has decided to cancel the initiative immediately.","Short-term data alone may not be enough to judge whether the change works.","The initiative has already been proven successful everywhere."],"answer":2,"evidence":"so if the trial continues, it should be evaluated against a baseline, not against last weekâ€™s mood."},{"id":91,"genre":"society_culture","style":"internal_memo","qtype":"inference","passage":"To: All staff\nSubject: Update on an internal tool\n\nWe have expanded an internal tool over the past year in response to delayed shipments. Please note that the goal is not to maximize output at any cost; it is to improve error rate without increasing risk. If you notice confusion about responsibilities, flag it to your lead immediately. Do not assume that a single good week proves the change is working. In addition, we will review results after the next reporting cycle and adjust the guidelines where needed.","question":"What can be inferred from the passage?","choices":["The initiative has already been proven successful everywhere.","The organization has decided to cancel the initiative immediately.","The passage states that costs will definitely fall next month.","The organization is continuing the initiative while refining how it is implemented."],"answer":3,"evidence":"in addition, we will review results after the next reporting cycle and adjust the guidelines where needed."},{"id":92,"genre":"technology","style":"news_article","qtype":"main_idea","passage":"A public agency has tested an internal tool since early spring, aiming to address declining attendance.\n\nEarly figures show mixed results: customer satisfaction improved slightly in some locations, but changed little in others. Managers say the biggest obstacle is consistencyâ€”local teams interpret the guidance differently, and some lack the tools to track outcomes. As a result, analysts caution that short-term data can be misleading because seasonal demand distorts comparisons. Consequently, the organization plans to keep the trial running and publish clearer benchmarks before deciding on a wider rollout.","question":"Which statement best expresses the main idea of the passage?","choices":["The passage is mainly about replacing all staff with automation.","The passage argues that financial profit is the only meaningful goal.","The organization is using evidence and feedback to decide how to proceed with a recent change.","The passage explains the history of a river system in detail."],"answer":2,"evidence":"Early figures show mixed results: customer satisfaction improved slightly in some locations, but changed little in others."},{"id":93,"genre":"education_training","style":"news_article","qtype":"reference","passage":"A public agency has revised a maintenance schedule over the past year, aiming to address traffic congestion.\n\nEarly figures show mixed results: on-time delivery improved initially in some locations, but changed little in others. Managers say the biggest obstacle is consistencyâ€”local teams interpret the guidance differently, and some lack the tools to track outcomes. Nevertheless, analysts caution that short-term data can be misleading because seasonal demand distorts comparisons. As a result, the organization plans to keep the trial running and publish clearer benchmarks before deciding on a wider rollout. Overall, it will be judged against longer-term trends rather than a single week.","question":"In the passage, the word 'it' most likely refers to what?","choices":["the trial","the equator","the Atlantic Ocean","the weather"],"answer":0,"evidence":"Overall, it will be judged against longer-term trends rather than a single week."},{"id":94,"genre":"hr_workplace","style":"email_thread","qtype":"inference","passage":"From: Maya To: Project group Iâ€™m concerned that complaint volume has worsened since we tested a pilot program. Several customers mentioned declining attendance in their last calls. In contrast I also saw one branch improve gradually, which makes me think execution differs by team.\n\nReply (Alex): We should separate the change itself from training. The checklist wasnâ€™t shared with new hires. Letâ€™s run a short refresher session and compare results over two weeks before we reverse the decision.","question":"What can be inferred from the passage?","choices":["Short-term data alone may not be enough to judge whether the change works.","The organization has decided to cancel the initiative immediately.","The passage states that costs will definitely fall next month.","The initiative has already been proven successful everywhere."],"answer":0,"evidence":"Reply (Alex): We should separate the change itself from training."},{"id":95,"genre":"finance","style":"news_article","qtype":"best_title","passage":"A public agency has standardized a reporting system over the past year, aiming to address customer churn.\n\nEarly figures show uneven results: retention improved slightly in some locations, but changed little in others. Managers say the biggest obstacle is consistencyâ€”local teams interpret the guidance differently, and some lack the tools to track outcomes. On the other hand, analysts caution that short-term data can be misleading because seasonal demand distorts comparisons. In addition, the organization plans to keep the trial running and publish clearer benchmarks before deciding on a wider rollout.","question":"Which title best fits the passage?","choices":["How to Build a Keyboard From Scratch","Measuring Success Beyond Short-Term Numbers","A Guide to Cooking for Large Events","Ten Beaches to Visit This Summer"],"answer":1,"evidence":"Early figures show uneven results: retention improved slightly in some locations, but changed little in others."},{"id":96,"genre":"business_strategy","style":"interview_qna","qtype":"purpose","passage":"Q: Why did you revis a pilot program?\nA: We needed a practical response to data privacy concerns. We werenâ€™t looking for a miracle; we wanted stable gains in customer satisfaction.\n\nQ: Did it work?\nA: The picture is encouraging. Some teams improved slightly, but others struggled because they lacked shared definitions. Therefore we learned that the change requires coaching, not just an announcement. For instance weâ€™ll adjust the plan and continue collecting data before making a final decision.","question":"What is the primary purpose of the passage?","choices":["To report mixed outcomes and recommend next steps.","To provide step-by-step technical instructions for installing software.","To entertain readers with a fictional story.","To advertise a product with limited stock."],"answer":0,"evidence":"We werenâ€™t looking for a miracle; we wanted stable gains in customer satisfaction."},{"id":97,"genre":"science_general","style":"case_study","qtype":"purpose","passage":"Case study: Turning around error rate\n\nWhen a software startup noticed declining attendance, it revised a reporting system for a three-month trial. Teams received a short guide and a single target. Results were mixed: the best sites improved error rate gradually, while the weakest sites barely moved. Interviews showed an unexpected patternâ€”sites that improved spent more time clarifying roles than pushing for speed. Nevertheless the company revised the guide with concrete examples and removed optional steps. Leaders plan to scale the approach only after confirming the same gains in a second region.","question":"What is the primary purpose of the passage?","choices":["To describe a recent change and discuss how it is being evaluated.","To entertain readers with a fictional story.","To provide step-by-step technical instructions for installing software.","To advertise a product with limited stock."],"answer":0,"evidence":"Case study: Turning around error rate When a software startup noticed declining attendance, it revised a reporting system for a three-month trial."},{"id":98,"genre":"health","style":"interview_qna","qtype":"main_idea","passage":"Q: Why did you standardiz a reporting system?\nA: We needed a practical response to staff fatigue. We werenâ€™t looking for a miracle; we wanted stable gains in complaint volume.\n\nQ: Did it work?\nA: The picture is uneven. Some teams improved slightly, but others struggled because they lacked shared definitions. Still we learned that the change requires coaching, not just an announcement. Meanwhile weâ€™ll adjust the plan and continue collecting data before making a final decision.","question":"Which statement best expresses the main idea of the passage?","choices":["The passage explains the history of a river system in detail.","The organization is using evidence and feedback to decide how to proceed with a recent change.","The passage is mainly about replacing all staff with automation.","The passage argues that financial profit is the only meaningful goal."],"answer":1,"evidence":"Q: Why did you standardiz a reporting system?"},{"id":99,"genre":"operations_logistics","style":"report_summary","qtype":"tone","passage":"Summary report Objective: reduce rising costs and improve response time.\n\nMethod: standardized an internal tool in the last six months across multiple sites. Findings: outcomes were surprising. Sites with clear ownership improved response time only; sites with frequent staff changes did not. Instead qualitative feedback suggests the instructions were interpreted inconsistently. The recommendation is to refine the guidance, retrain affected teams, and reassess after the next cycle.","question":"Which word best describes the tone of the passage?","choices":["sarcastic","playful","furious","analytical"],"answer":3,"evidence":"Summary report Objective: reduce rising costs and improve response time."},{"id":100,"genre":"operations_logistics","style":"news_article","qtype":"purpose","passage":"A software startup has expanded a pilot program since early spring, aiming to address data privacy concerns.\n\nEarly figures show encouraging results: revenue per user improved only in some locations, but changed little in others. Managers say the biggest obstacle is consistencyâ€”local teams interpret the guidance differently, and some lack the tools to track outcomes. Still, analysts caution that short-term data can be misleading because seasonal demand distorts comparisons. Consequently, the organization plans to keep the trial running and publish clearer benchmarks before deciding on a wider rollout.","question":"What is the primary purpose of the passage?","choices":["To entertain readers with a fictional story.","To advertise a product with limited stock.","To provide step-by-step technical instructions for installing software.","To report mixed outcomes and recommend next steps."],"answer":3,"evidence":"A software startup has expanded a pilot program since early spring, aiming to address data privacy concerns."}];

// ===== STATE =====
const STORAGE_KEY = 'worddrill_data';
let state = loadState();
let currentSession = null;

function defaultState() {
  return {
    wordStats: {},  // { "implement": { correct: 0, wrong: 0, lastSeen: null } }
    dailyLog: {},   // { "2025-01-15": { sessions: 1, correct: 10, wrong: 3, words: ["implement",...] } }
    settings: { questionCount: 20 }
  };
}

function loadState() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) return JSON.parse(raw);
  } catch(e) {}
  return defaultState();
}

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  pushToCloud();
}

function today() {
  return new Date().toISOString().slice(0, 10);
}

// ===== NAVIGATION =====
function showScreen(name) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-' + name).classList.add('active');
  document.querySelectorAll('.nav-btn').forEach((b, i) => {
    b.classList.toggle('active', ['home','quiz','writing','reading','dashboard'][i] === name);
  });
  if (name === 'dashboard') renderDashboard();
  if (name === 'home') renderHome();
}

// ===== HOME =====
function renderHome() {
  const d = state.dailyLog[today()] || { correct: 0, wrong: 0, words: [] };
  document.getElementById('homeTodayCount').textContent = d.words ? d.words.length : 0;
  const total = d.correct + d.wrong;
  document.getElementById('homeTodayAcc').textContent = total > 0 ? Math.round(d.correct / total * 100) + '%' : '-';
  updateStreak();
}

function updateStreak() {
  let streak = 0;
  const d = new Date();
  // Check if today has activity, if not start from yesterday
  if (!state.dailyLog[today()]) {
    d.setDate(d.getDate() - 1);
  }
  while (true) {
    const key = d.toISOString().slice(0, 10);
    if (state.dailyLog[key]) {
      streak++;
      d.setDate(d.getDate() - 1);
    } else break;
  }
  const el = document.getElementById('streakDisplay');
  if (streak > 0) {
    el.style.display = 'flex';
    document.getElementById('streakCount').textContent = streak;
  } else {
    el.style.display = 'none';
  }
  return streak;
}

// ===== QUIZ =====
function startQuiz(mode, direction) {
  const count = parseInt(document.getElementById('questionCount').value);
  let pool = [...WORDS];

  if (mode === 'weak') {
    pool = pool.filter(w => {
      const s = state.wordStats[w.en];
      return s && s.wrong > 0 && (s.correct / (s.correct + s.wrong)) < 0.8;
    });
    if (pool.length === 0) { toast('è‹¦æ‰‹ãªå˜èªãŒã¾ã ã‚ã‚Šã¾ã›ã‚“'); return; }
  } else if (mode === 'unseen') {
    pool = pool.filter(w => !state.wordStats[w.en]);
    if (pool.length === 0) { toast('å…¨å˜èªå­¦ç¿’æ¸ˆã¿ã§ã™ï¼'); return; }
  }

  shuffle(pool);
  pool = pool.slice(0, Math.min(count, pool.length));

  currentSession = {
    type: 'quiz',
    direction: direction || 'en2ja',
    questions: pool,
    current: 0,
    correct: 0,
    wrong: 0,
    wrongWords: [],
    answered: false
  };

  showScreen('quiz');
  document.getElementById('quizActive').style.display = '';
  document.getElementById('quizResults').style.display = 'none';
  renderQuizQuestion();
}

function renderQuizQuestion() {
  const s = currentSession;
  if (s.current >= s.questions.length) { showQuizResults(); return; }

  s.answered = false;
  const word = s.questions[s.current];
  const isJa2En = s.direction === 'ja2en';
  const pct = (s.current / s.questions.length * 100).toFixed(0);
  document.getElementById('quizProgressFill').style.width = pct + '%';
  document.getElementById('quizProgressText').textContent = `${s.current + 1} / ${s.questions.length}`;

  const card = document.getElementById('quizCard');
  card.classList.remove('animate-in');
  void card.offsetWidth;
  card.classList.add('animate-in');
  document.querySelector('#quizCard .card-label').textContent = isJa2En ? 'æ—¥æœ¬èª' : 'English';
  const wordEl = document.getElementById('quizWord');
  wordEl.textContent = isJa2En ? word.ja : word.en;
  wordEl.style.fontSize = isJa2En ? '1.5rem' : '';

  // Generate 4 choices
  const choices = [word];
  const others = WORDS.filter(w => w.en !== word.en);
  shuffle(others);
  for (let i = 0; choices.length < 4 && i < others.length; i++) {
    const dupKey = isJa2En ? 'en' : 'ja';
    if (!choices.some(c => c[dupKey] === others[i][dupKey])) {
      choices.push(others[i]);
    }
  }
  shuffle(choices);

  const keys = ['A', 'B', 'C', 'D'];
  const container = document.getElementById('quizChoices');
  container.innerHTML = choices.map((c, i) => `
    <button class="choice-btn" onclick="answerQuiz(this, '${escape(c.en)}', '${escape(word.en)}')">
      <span class="choice-key">${keys[i]}</span>
      <span>${isJa2En ? c.en : c.ja}</span>
    </button>
  `).join('');
}

function escape(s) { return s.replace(/'/g, "\\'"); }

function answerQuiz(btn, chosen, correct) {
  if (currentSession.answered) return;
  currentSession.answered = true;

  const word = currentSession.questions[currentSession.current];
  const isJa2En = currentSession.direction === 'ja2en';
  const isCorrect = chosen === correct;
  const correctText = isJa2En ? word.en : word.ja;
  const buttons = document.querySelectorAll('.choice-btn');

  buttons.forEach(b => {
    b.classList.add('disabled');
    if (b.querySelector('span:last-child').textContent === correctText) {
      b.classList.add('correct');
    }
  });

  if (isCorrect) {
    btn.classList.add('correct');
    currentSession.correct++;
  } else {
    btn.classList.add('wrong');
    currentSession.wrong++;
    currentSession.wrongWords.push(word);
  }

  recordWord(word.en, isCorrect);

  setTimeout(() => {
    currentSession.current++;
    renderQuizQuestion();
  }, isCorrect ? 600 : 1200);
}

function showQuizResults() {
  document.getElementById('quizActive').style.display = 'none';
  document.getElementById('quizResults').style.display = '';

  const s = currentSession;
  const pct = Math.round(s.correct / s.questions.length * 100);
  document.getElementById('quizScore').textContent = pct + '%';
  document.getElementById('quizTotal').textContent = s.questions.length;
  document.getElementById('quizCorrectCount').textContent = s.correct;
  document.getElementById('quizWrongCount').textContent = s.wrong;

  const listEl = document.getElementById('quizWrongList');
  if (s.wrongWords.length > 0) {
    listEl.innerHTML = '<h3>é–“é•ãˆãŸå˜èª</h3>' + s.wrongWords.map(w =>
      `<div class="wrong-word-item"><span class="en">${w.en}</span><span class="ja">${w.ja}</span></div>`
    ).join('');
  } else {
    listEl.innerHTML = '<h3 style="color:var(--correct)">ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼å…¨å•æ­£è§£ï¼</h3>';
  }

  recordSession();
}

// ===== WRITING =====
function startWriting(mode) {
  const count = parseInt(document.getElementById('questionCount').value);
  let pool = [...WORDS];

  if (mode === 'weak') {
    pool = pool.filter(w => {
      const s = state.wordStats[w.en];
      return s && s.wrong > 0;
    });
    if (pool.length === 0) { toast('è‹¦æ‰‹ãªå˜èªãŒã¾ã ã‚ã‚Šã¾ã›ã‚“'); return; }
  }

  shuffle(pool);
  pool = pool.slice(0, Math.min(count, pool.length));

  currentSession = {
    type: 'writing',
    questions: pool,
    current: 0,
    correct: 0,
    wrong: 0,
    wrongWords: [],
    answered: false,
    hintLevel: 0
  };

  showScreen('writing');
  document.getElementById('writingActive').style.display = '';
  document.getElementById('writingResults').style.display = 'none';
  renderWriteQuestion();
}

function renderWriteQuestion() {
  const s = currentSession;
  if (s.current >= s.questions.length) { showWriteResults(); return; }

  s.answered = false;
  s.hintLevel = 0;
  const word = s.questions[s.current];
  const pct = (s.current / s.questions.length * 100).toFixed(0);
  document.getElementById('writeProgressFill').style.width = pct + '%';
  document.getElementById('writeProgressText').textContent = `${s.current + 1} / ${s.questions.length}`;

  const card = document.getElementById('writeCard');
  card.classList.remove('animate-in');
  void card.offsetWidth;
  card.classList.add('animate-in');
  document.getElementById('writeWord').textContent = word.ja;

  const input = document.getElementById('writeInput');
  input.value = '';
  input.className = 'writing-input';
  input.disabled = false;
  input.focus();
  document.getElementById('writeHint').textContent = '';
  document.getElementById('writeAnswer').style.display = 'none';
  document.getElementById('writeSubmitBtn').textContent = 'å›ç­”ã™ã‚‹';
  document.getElementById('writeHintBtn').style.display = '';
}

function showWriteHint() {
  const s = currentSession;
  if (s.answered) return;
  const word = s.questions[s.current].en;
  s.hintLevel++;

  let hint = '';
  if (s.hintLevel === 1) {
    hint = `${word.length}æ–‡å­—`;
  } else if (s.hintLevel === 2) {
    hint = word[0] + '_'.repeat(word.length - 1);
  } else {
    // Show every other letter
    hint = word.split('').map((c, i) => i % 2 === 0 ? c : '_').join('');
  }
  document.getElementById('writeHint').textContent = 'ãƒ’ãƒ³ãƒˆ: ' + hint;
}

function submitWriting() {
  const s = currentSession;
  if (!s) return;

  if (s.answered) {
    s.current++;
    renderWriteQuestion();
    return;
  }

  const input = document.getElementById('writeInput');
  const userAnswer = input.value.trim().toLowerCase();
  const word = s.questions[s.current];
  const correct = word.en.toLowerCase();

  if (!userAnswer) { input.focus(); return; }

  s.answered = true;
  input.disabled = true;

  const isCorrect = userAnswer === correct;
  input.classList.add(isCorrect ? 'correct' : 'wrong');

  if (isCorrect) {
    s.correct++;
    document.getElementById('writeAnswer').style.display = 'none';
  } else {
    s.wrong++;
    s.wrongWords.push(word);
    const answerEl = document.getElementById('writeAnswer');
    answerEl.style.display = '';
    answerEl.innerHTML = `æ­£è§£: <strong>${word.en}</strong>`;
  }

  recordWord(word.en, isCorrect);
  document.getElementById('writeSubmitBtn').textContent = 'æ¬¡ã®å•é¡Œ';
  document.getElementById('writeHintBtn').style.display = 'none';
}

function showWriteResults() {
  document.getElementById('writingActive').style.display = 'none';
  document.getElementById('writingResults').style.display = '';

  const s = currentSession;
  const pct = Math.round(s.correct / s.questions.length * 100);
  document.getElementById('writeScore').textContent = pct + '%';
  document.getElementById('writeTotal').textContent = s.questions.length;
  document.getElementById('writeCorrectCount').textContent = s.correct;
  document.getElementById('writeWrongCount').textContent = s.wrong;

  const listEl = document.getElementById('writeWrongList');
  if (s.wrongWords.length > 0) {
    listEl.innerHTML = '<h3>é–“é•ãˆãŸå˜èª</h3>' + s.wrongWords.map(w =>
      `<div class="wrong-word-item"><span class="en">${w.en}</span><span class="ja">${w.ja}</span></div>`
    ).join('');
  } else {
    listEl.innerHTML = '<h3 style="color:var(--correct)">ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼å…¨å•æ­£è§£ï¼</h3>';
  }

  recordSession();
}

// ===== RETRY WRONG =====
function retryWrong(mode) {
  if (!currentSession || currentSession.wrongWords.length === 0) return;
  const wrongWords = [...currentSession.wrongWords];

  if (mode === 'quiz') {
    const dir = currentSession.direction || 'en2ja';
    currentSession = {
      type: 'quiz', direction: dir, questions: wrongWords, current: 0,
      correct: 0, wrong: 0, wrongWords: [], answered: false
    };
    document.getElementById('quizActive').style.display = '';
    document.getElementById('quizResults').style.display = 'none';
    renderQuizQuestion();
  } else {
    currentSession = {
      type: 'writing', questions: wrongWords, current: 0,
      correct: 0, wrong: 0, wrongWords: [], answered: false, hintLevel: 0
    };
    document.getElementById('writingActive').style.display = '';
    document.getElementById('writingResults').style.display = 'none';
    renderWriteQuestion();
  }
}

// ===== RECORD =====
function recordWord(en, isCorrect) {
  if (!state.wordStats[en]) {
    state.wordStats[en] = { correct: 0, wrong: 0, lastSeen: null };
  }
  const ws = state.wordStats[en];
  if (isCorrect) ws.correct++; else ws.wrong++;
  ws.lastSeen = today();

  const d = today();
  if (!state.dailyLog[d]) {
    state.dailyLog[d] = { sessions: 0, correct: 0, wrong: 0, words: [] };
  }
  const dl = state.dailyLog[d];
  if (isCorrect) dl.correct++; else dl.wrong++;
  if (!dl.words.includes(en)) dl.words.push(en);

  saveState();
}

function recordSession() {
  const d = today();
  if (!state.dailyLog[d]) {
    state.dailyLog[d] = { sessions: 0, correct: 0, wrong: 0, words: [] };
  }
  state.dailyLog[d].sessions++;
  saveState();
}

// ===== DASHBOARD =====
function renderDashboard() {
  // Calendar
  const cal = document.getElementById('calendar');
  cal.innerHTML = '';
  const now = new Date();
  for (let i = 29; i >= 0; i--) {
    const d = new Date(now);
    d.setDate(d.getDate() - i);
    const key = d.toISOString().slice(0, 10);
    const log = state.dailyLog[key];
    let lvl = 0;
    if (log) {
      const count = log.words ? log.words.length : 0;
      if (count >= 50) lvl = 4;
      else if (count >= 30) lvl = 3;
      else if (count >= 10) lvl = 2;
      else if (count > 0) lvl = 1;
    }
    const dayEl = document.createElement('div');
    dayEl.className = 'cal-day' + (lvl ? ' lv' + lvl : '');
    const tipText = log ? `${key}: ${log.words ? log.words.length : 0}èª` : `${key}: æœªå­¦ç¿’`;
    dayEl.innerHTML = `<div class="cal-day-tooltip">${tipText}</div>`;
    cal.appendChild(dayEl);
  }

  // Stats
  let totalSessions = 0, totalCorrect = 0, totalWrong = 0;
  Object.values(state.dailyLog).forEach(d => {
    totalSessions += d.sessions || 0;
    totalCorrect += d.correct || 0;
    totalWrong += d.wrong || 0;
  });

  document.getElementById('dashTotalSessions').textContent = totalSessions;
  const totalAttempts = totalCorrect + totalWrong;
  document.getElementById('dashOverallAcc').textContent = totalAttempts > 0
    ? Math.round(totalCorrect / totalAttempts * 100) + '%' : '-';
  document.getElementById('dashStreak').textContent = updateStreak();

  // Mastered count
  let mastered = 0;
  WORDS.forEach(w => {
    const s = state.wordStats[w.en];
    if (s && (s.correct + s.wrong) >= 3 && s.correct / (s.correct + s.wrong) >= 0.8) mastered++;
  });
  document.getElementById('dashMastered').textContent = mastered;

  // Word list
  const list = document.getElementById('wordList');
  const sorted = WORDS.map(w => {
    const s = state.wordStats[w.en] || { correct: 0, wrong: 0 };
    const total = s.correct + s.wrong;
    const acc = total > 0 ? s.correct / total : -1;
    return { ...w, acc, total, ...s };
  }).sort((a, b) => a.acc - b.acc);

  list.innerHTML = sorted.map(w => {
    const accPct = w.total > 0 ? Math.round(w.acc * 100) : 0;
    const lvl = w.acc < 0 ? 'low' : w.acc < 0.5 ? 'low' : w.acc < 0.8 ? 'mid' : 'high';
    const accText = w.total > 0 ? accPct + '%' : 'æœª';
    return `<div class="word-row">
      <div class="word-mastery"><div class="word-mastery-fill ${lvl}" style="width:${Math.max(accPct, 5)}%"></div></div>
      <span class="word-en">${w.en}</span>
      <span class="word-ja">${w.ja}</span>
      <span class="word-acc">${accText}</span>
    </div>`;
  }).join('');
}

// ===== UTILITIES =====
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 2000);
}

function exportData() {
  const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'worddrill_backup_' + today() + '.json';
  a.click(); URL.revokeObjectURL(url);
  toast('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
}

function resetConfirm() {
  if (confirm('å…¨ã¦ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚')) {
    state = defaultState();
    saveState();
    renderHome();
    toast('ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
  }
}

// ===== KEYBOARD =====
document.addEventListener('keydown', e => {
  if (!currentSession) return;

  // Quiz keyboard shortcuts
  if (currentSession.type === 'quiz' && !currentSession.answered) {
    const keyMap = { '1': 0, '2': 1, '3': 2, '4': 3, 'a': 0, 'b': 1, 'c': 2, 'd': 3 };
    const idx = keyMap[e.key.toLowerCase()];
    if (idx !== undefined) {
      const btns = document.querySelectorAll('.choice-btn');
      if (btns[idx]) btns[idx].click();
    }
  }

  // Writing Enter to submit
  if (currentSession.type === 'writing' && e.key === 'Enter') {
    submitWriting();
  }
});

// ===== READING QUIZ =====
function startReading(mode) {
  const count = parseInt(document.getElementById('questionCount').value);
  let pool = [...READING_QUESTIONS];

  if (mode === 'weak') {
    pool = pool.filter(q => {
      const s = state.wordStats['read_' + q.id];
      return s && s.wrong > 0 && (s.correct / (s.correct + s.wrong)) < 0.8;
    });
    if (pool.length === 0) { toast('è‹¦æ‰‹ãªå•é¡ŒãŒã¾ã ã‚ã‚Šã¾ã›ã‚“'); return; }
  }

  shuffle(pool);
  pool = pool.slice(0, Math.min(count, pool.length));

  currentSession = {
    type: 'reading',
    questions: pool,
    current: 0,
    correct: 0,
    wrong: 0,
    wrongWords: [],
    answered: false,
    times: []
  };

  showScreen('reading');
  document.getElementById('readingActive').style.display = '';
  document.getElementById('readingResults').style.display = 'none';
  renderReadingQuestion();
}

// Highlight absolute/strong words in choice text
function highlightStrongWords(text) {
  return text.replace(/\b(always|must|only|all|never|completely|every|none|nobody|impossible|certainly|absolutely|entirely|no one|nothing)\b/gi,
    '<span class="strong-word">$1</span>');
}

function renderReadingQuestion() {
  const s = currentSession;
  if (s.current >= s.questions.length) { showReadingResults(); return; }

  s.answered = false;
  s.questionStartTime = Date.now();
  const q = s.questions[s.current];
  const pct = (s.current / s.questions.length * 100).toFixed(0);
  document.getElementById('readProgressFill').style.width = pct + '%';
  document.getElementById('readProgressText').textContent = `${s.current + 1} / ${s.questions.length}`;

  const card = document.getElementById('readCard');
  card.classList.remove('animate-in');
  void card.offsetWidth;
  card.classList.add('animate-in');

  document.getElementById('readGenre').textContent = q.genre.replace(/_/g,' ') + ' / ' + q.style.replace(/_/g,' ');
  document.getElementById('readPassage').textContent = q.passage;
  document.getElementById('readQuestion').textContent = q.question;

  const keys = ['A', 'B', 'C', 'D'];
  const container = document.getElementById('readChoices');
  container.innerHTML = q.choices.map((c, i) => `
    <button class="choice-btn" onclick="answerReading(this, ${i})">
      <span class="choice-key">${keys[i]}</span>
      <span>${highlightStrongWords(c)}</span>
    </button>
  `).join('');

  document.getElementById('readExplanation').style.display = 'none';
  document.getElementById('readNextBtn').style.display = 'none';
}

function answerReading(btn, chosen) {
  if (currentSession.answered) return;
  currentSession.answered = true;

  const q = currentSession.questions[currentSession.current];
  const isCorrect = chosen === q.answer;
  const buttons = document.querySelectorAll('#readChoices .choice-btn');

  buttons.forEach((b, i) => {
    b.classList.add('disabled');
    if (i === q.answer) b.classList.add('correct');
  });

  if (isCorrect) {
    btn.classList.add('correct');
    currentSession.correct++;
  } else {
    btn.classList.add('wrong');
    currentSession.wrong++;
    currentSession.wrongWords.push(q);
  }

  recordWord('read_' + q.id, isCorrect);

  // Record answer time
  const elapsed = Math.round((Date.now() - currentSession.questionStartTime) / 1000);
  if (!currentSession.times) currentSession.times = [];
  currentSession.times.push(elapsed);

  // Show evidence + explanation
  document.getElementById('readEvidence').textContent = q.evidence || '';
  document.getElementById('readEvidence').style.display = q.evidence ? '' : 'none';
  document.getElementById('readExpText').textContent = getReadingExplanation(q);
  document.getElementById('readTimer').textContent = `å›ç­”æ™‚é–“: ${elapsed}ç§’`;
  document.getElementById('readExplanation').style.display = '';
  document.getElementById('readNextBtn').style.display = '';
}

function nextReading() {
  currentSession.current++;
  renderReadingQuestion();
}

function getReadingExplanation(q) {
  const correct = q.choices[q.answer];
  const p = q.passage;
  const pl = p.toLowerCase();
  const t = q.qtype;

  // Extract key content from passage
  const extractQuote = (keywords) => {
    const sentences = p.split(/\.\s+/).filter(s => s.length > 15);
    for (const kw of keywords) {
      const found = sentences.find(s => s.toLowerCase().includes(kw));
      if (found) return '"' + found.trim().slice(0, 80) + '..."';
    }
    return null;
  };

  if (t === 'tone') {
    const toneWord = correct.toLowerCase();
    const evidence = [];
    if (pl.includes('caution') || pl.includes('evaluated against a baseline')) evidence.push('æ…é‡ãªè©•ä¾¡ã‚’ä¿ƒã™è¡¨ç¾');
    if (pl.includes('not to maximize') || pl.includes('without increasing risk')) evidence.push('ãƒªã‚¹ã‚¯ã‚’è€ƒæ…®ã—ãŸæŠ‘åˆ¶çš„ãªè¡¨ç¾');
    if (pl.includes('mixed') || pl.includes('uneven') || pl.includes('limited')) evidence.push('çµæœã‚’å®¢è¦³çš„ã«æå†™ã™ã‚‹è¡¨ç¾');
    if (pl.includes('do not assume')) evidence.push('"do not assume" ã¨ã„ã†æ³¨æ„å–šèµ·');
    if (pl.includes('wobble') || pl.includes('tempting')) evidence.push('çš®è‚‰ã‚’å«ã¿ã¤ã¤ã‚‚å†·é™ãªè«–èª¿');
    if (pl.includes('practical response') || pl.includes('adjust the plan')) evidence.push('å®Ÿç”¨çš„ãªå¯¾å¿œã‚’é‡è¦–ã™ã‚‹å§¿å‹¢');
    const evStr = evidence.length > 0 ? evidence.join('ã€') : 'æ ¹æ‹ ã«åŸºã¥ãæ…é‡ãªè¨€ã„å›ã—';
    return `æ­£è§£ã¯ã€Œ${correct}ã€ã€‚æ–‡ä¸­ã«ã¯${evStr}ãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚æ„Ÿæƒ…çš„ãƒ»æ”»æ’ƒçš„(furious)ã§ã‚‚ã€ãµã–ã‘ãŸ(playful)èª¿å­ã§ã‚‚ã€çš®è‚‰(sarcastic)ã§ã‚‚ãªãã€è¨¼æ‹ ã‚’é‡è¦–ã—ãªãŒã‚‰åˆ¤æ–­ã™ã‚‹${toneWord}ãªãƒˆãƒ¼ãƒ³ã§ã™ã€‚`;
  }

  if (t === 'best_title') {
    const coreTheme = pl.includes('mixed') || pl.includes('uneven') || pl.includes('limited') || pl.includes('steady') ? 'çµæœãŒã°ã‚‰ã¤ã„ã¦ã„ã‚‹'
      : pl.includes('surprising') || pl.includes('encouraging') ? 'ä¸€éƒ¨ã§æ”¹å–„ãŒè¦‹ã‚‰ã‚Œã‚‹' : 'æ–½ç­–ã®é€”ä¸­çµŒéã‚’å ±å‘Šã—ã¦ã„ã‚‹';
    const nextStep = pl.includes('refine') || pl.includes('retrain') ? 'æ”¹å–„ã¨å†è©•ä¾¡'
      : pl.includes('adjust') ? 'è¨ˆç”»ã®ä¿®æ­£' : 'ã•ã‚‰ãªã‚‹æ¤œè¨¼';
    return `æ­£è§£ã¯ã€Œ${correct}ã€ã€‚æ–‡ç« å…¨ä½“ã¯${coreTheme}ã“ã¨ã‚’è¿°ã¹ã€${nextStep}ã®å¿…è¦æ€§ã‚’è¨´ãˆã¦ã„ã¾ã™ã€‚ä»–ã®é¸æŠè‚¢ï¼ˆæ–™ç†ãƒ»ãƒ“ãƒ¼ãƒãƒ»ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰è£½ä½œï¼‰ã¯æœ¬æ–‡ã®å†…å®¹ã¨ç„¡é–¢ä¿‚ã§ã™ã€‚`;
  }

  if (t === 'inference') {
    const quote = extractQuote(['uneven', 'mixed', 'limited', 'barely moved', 'struggled', 'consistency', 'continue', 'refine', 'adjust']);
    if (correct.includes('Short-term data'))
      return `æ­£è§£ã¯ã€Œ${correct}ã€ã€‚æ–‡ä¸­ã§çµæœãŒæ‹ ç‚¹ã«ã‚ˆã‚Šã°ã‚‰ã¤ãã“ã¨ï¼ˆ${quote || '"the weakest sites barely moved"'}ï¼‰ãŒè¿°ã¹ã‚‰ã‚Œã¦ãŠã‚Šã€çŸ­æœŸãƒ‡ãƒ¼ã‚¿ã ã‘ã§ã¯åˆ¤æ–­ã§ããªã„ã“ã¨ãŒç¤ºå”†ã•ã‚Œã¦ã„ã¾ã™ã€‚ã€Œã™ã§ã«æˆåŠŸã€ã€Œå³åº§ã«ä¸­æ­¢ã€ã€Œã‚³ã‚¹ãƒˆãŒå¿…ãšä¸‹ãŒã‚‹ã€ã¯ã„ãšã‚Œã‚‚æœ¬æ–‡ã«æ ¹æ‹ ãŒã‚ã‚Šã¾ã›ã‚“ã€‚`;
    if (correct.includes('continuing the initiative'))
      return `æ­£è§£ã¯ã€Œ${correct}ã€ã€‚æ–‡ä¸­ã§çµæœãŒä¸å‡ä¸€ãªãŒã‚‰ã‚‚ "adjust the plan" "continue collecting data" "reassess" ç­‰ã®è¡¨ç¾ãŒã‚ã‚Šã€ä¸­æ­¢ã§ã¯ãªãæ”¹å–„ã—ãªãŒã‚‰ç¶™ç¶šã™ã‚‹æ–¹é‡ãŒèª­ã¿å–ã‚Œã¾ã™ã€‚`;
    if (correct.includes('Differences in execution'))
      return `æ­£è§£ã¯ã€Œ${correct}ã€ã€‚æ–‡ä¸­ã§ä¸€éƒ¨ã®æ‹ ç‚¹ã¯æ”¹å–„ã—ä»–ã¯å¤‰åŒ–ãŒãªã„ã¨è¿°ã¹ã‚‰ã‚Œã€"execution differs by team" ã‚„ "local teams interpret the guidance differently" ãŒå®Ÿè¡Œé¢ã®ã°ã‚‰ã¤ãã‚’ç›´æ¥æŒ‡æ‘˜ã—ã¦ã„ã¾ã™ã€‚`;
    return `æ­£è§£ã¯ã€Œ${correct}ã€ã€‚æ–‡ç« ã®è¨¼æ‹ ã‹ã‚‰ç›´æ¥å°ã‘ã‚‹æœ€ã‚‚å¦¥å½“ãªæ¨è«–ã§ã™ã€‚ä»–ã®é¸æŠè‚¢ã¯æœ¬æ–‡ã«ãªã„æƒ…å ±ã‚’å‰æã¨ã—ã¦ã„ã¾ã™ã€‚`;
  }

  if (t === 'reference') {
    // Find the sentence containing 'it'
    const sentences = p.split(/\.\s+/);
    let context = '';
    for (let i = 0; i < sentences.length; i++) {
      if (/\bit\b/i.test(sentences[i]) && !sentences[i].toLowerCase().startsWith('it is tempting')) {
        const prev = i > 0 ? sentences[i-1].trim().slice(-60) : '';
        context = prev ? `å‰æ–‡ "...${prev}" ã«ç¶šã„ã¦` : 'æ–‡è„ˆã‹ã‚‰';
        break;
      }
    }
    return `æ­£è§£ã¯ã€Œ${correct}ã€ã€‚${context} "it" ãŒä½¿ã‚ã‚Œã¦ãŠã‚Šã€å‰å¾Œã®æ–‡è„ˆï¼ˆevaluate, review, results, adjust ç­‰ã®èªï¼‰ã‹ã‚‰ã€ã“ã® "it" ã¯è­°è«–ã•ã‚Œã¦ã„ã‚‹æ–½ç­–ãƒ»è©¦ã¿ãƒ»å¤‰æ›´ã‚’æŒ‡ã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚å¤©å€™ãƒ»å¤§è¥¿æ´‹ãƒ»èµ¤é“ã¯æ–‡ç« ã¨ç„¡é–¢ä¿‚ã§ã™ã€‚`;
  }

  if (t === 'purpose') {
    if (correct.includes('mixed outcomes') || correct.includes('report mixed'))
      return `æ­£è§£ã¯ã€Œ${correct}ã€ã€‚æ–‡ç« ã¯æ–½ç­–ã®çµæœï¼ˆæ”¹å–„ã—ãŸæ‹ ç‚¹ãƒ»ã—ãªã‹ã£ãŸæ‹ ç‚¹ï¼‰ã‚’å ±å‘Šã—ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆadjust, review, reassess ç­‰ï¼‰ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚è£½å“åºƒå‘Šãƒ»ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³ãƒ»ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢æ‰‹é †æ›¸ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚`;
    if (correct.includes('continuing despite'))
      return `æ­£è§£ã¯ã€Œ${correct}ã€ã€‚æ–‡ä¸­ã§çµæœãŒä¸å‡ä¸€ã§ã‚ã‚‹ã“ã¨ã‚’èªã‚ã¤ã¤ã‚‚ã€"continue collecting data" "refine the guidance" ãªã©ã€æ‰¹åˆ¤ãŒã‚ã£ã¦ã‚‚è©¦ã¿ã‚’ç¶™ç¶šã™ã‚‹ç†ç”±ã‚’èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚`;
    if (correct.includes('describe a recent change'))
      return `æ­£è§£ã¯ã€Œ${correct}ã€ã€‚æ–‡ç« ã¯æœ€è¿‘å°å…¥ã•ã‚ŒãŸå¤‰æ›´ã®å†…å®¹ãƒ»çµæœãƒ»è©•ä¾¡æ–¹æ³•ã‚’è¿°ã¹ã¦ã„ã¾ã™ã€‚ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³ãƒ»åºƒå‘Šãƒ»æŠ€è¡“ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã®ã„ãšã‚Œã§ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚`;
    return `æ­£è§£ã¯ã€Œ${correct}ã€ã€‚æ–‡ç« ã®ä¸»ãªç›®çš„ã¯ã€æ–½ç­–ã®çµŒéã‚’å ±å‘Šã—è©•ä¾¡ãƒ»æ”¹å–„ã«ã¤ã„ã¦è¿°ã¹ã‚‹ã“ã¨ã§ã™ã€‚`;
  }

  if (t === 'main_idea') {
    if (correct.includes('uneven results') || correct.includes('new initiative'))
      return `æ­£è§£ã¯ã€Œ${correct}ã€ã€‚æ–‡ä¸­ã§æ–½ç­–ã®çµæœã«ã°ã‚‰ã¤ããŒã‚ã‚Šï¼ˆbest sites improved / weakest sites barely movedï¼‰ã€ä¸€è²«æ€§ã‚’ç¢ºä¿ã—ã¦ã‹ã‚‰æ‹¡å¤§ã™ã‚‹æ–¹é‡ãŒè¿°ã¹ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã€Œå…¨ã‚¹ã‚¿ãƒƒãƒ•ã‚’è‡ªå‹•åŒ–ã«ç½®ãæ›ãˆã‚‹ã€ã€Œåˆ©ç›Šã ã‘ãŒç›®æ¨™ã€ã€Œå·ã®æ­´å²ã€ã¯æœ¬æ–‡ã¨ç„¡é–¢ä¿‚ã§ã™ã€‚`;
    if (correct.includes('implementation details') || correct.includes('clearer guidelines'))
      return `æ­£è§£ã¯ã€Œ${correct}ã€ã€‚çµæœãŒæ‹ ç‚¹ã«ã‚ˆã‚Šç•°ãªã‚‹åŸå› ã¨ã—ã¦ã€ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã®è§£é‡ˆã®é•ã„ã‚„ç ”ä¿®ã®ä¸è¶³ãŒæŒ™ã’ã‚‰ã‚Œã€ã‚ˆã‚Šæ˜ç¢ºãªåŸºæº–ã¨è¨ˆæ¸¬ãŒå¿…è¦ã ã¨ä¸»å¼µã—ã¦ã„ã¾ã™ã€‚`;
    if (correct.includes('using evidence'))
      return `æ­£è§£ã¯ã€Œ${correct}ã€ã€‚æ–‡ç« å…¨ä½“ã‚’é€šã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ã‚„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«åŸºã¥ã„ã¦æ¬¡ã®å¯¾å¿œã‚’æ±ºã‚ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ãŒæã‹ã‚Œã¦ã„ã¾ã™ã€‚æ„Ÿæƒ…çš„ãªåˆ¤æ–­ã‚„ä¸€æ–¹çš„ãªçµè«–ã§ã¯ãªãã€è¨¼æ‹ ã«åŸºã¥ãæ„æ€æ±ºå®šãŒãƒ†ãƒ¼ãƒã§ã™ã€‚`;
    return `æ­£è§£ã¯ã€Œ${correct}ã€ã€‚æœ¬æ–‡ã®ä¸»æ—¨ã¯ã€æ–½ç­–ã®çµæœã‚’åˆ†æã—æ”¹å–„ç­–ã‚’æ¤œè¨ã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã®æå†™ã§ã™ã€‚`;
  }

  return `æ­£è§£ã¯ã€Œ${correct}ã€ã€‚æœ¬æ–‡ã®å†…å®¹ã‹ã‚‰æœ€ã‚‚å¦¥å½“ã«å°ã‘ã‚‹é¸æŠè‚¢ã§ã™ã€‚`;
}

function showReadingResults() {
  document.getElementById('readingActive').style.display = 'none';
  document.getElementById('readingResults').style.display = '';

  const s = currentSession;
  const pct = Math.round(s.correct / s.questions.length * 100);
  document.getElementById('readScore').textContent = pct + '%';
  document.getElementById('readTotal').textContent = s.questions.length;
  document.getElementById('readCorrectCount').textContent = s.correct;
  document.getElementById('readWrongCount').textContent = s.wrong;

  // Average answer time
  if (s.times && s.times.length > 0) {
    const avg = Math.round(s.times.reduce((a, b) => a + b, 0) / s.times.length);
    document.getElementById('readAvgTime').textContent = avg + 'ç§’';
  } else {
    document.getElementById('readAvgTime').textContent = '--';
  }

  const listEl = document.getElementById('readWrongList');
  if (s.wrongWords.length > 0) {
    listEl.innerHTML = '<h3>é–“é•ãˆãŸå•é¡Œ</h3>' + s.wrongWords.map(q =>
      `<div class="wrong-word-item"><span class="en" style="font-size:0.8rem">${q.passage.slice(0, 50)}...</span><span class="ja" style="font-size:0.75rem">${q.choices[q.answer].slice(0, 30)}...</span></div>`
    ).join('');
  } else {
    listEl.innerHTML = '<h3 style="color:var(--correct)">ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼å…¨å•æ­£è§£ï¼</h3>';
  }

  recordSession();
}

function retryWrongReading() {
  if (!currentSession || currentSession.wrongWords.length === 0) return;
  const wrongQs = [...currentSession.wrongWords];
  currentSession = {
    type: 'reading', questions: wrongQs, current: 0,
    correct: 0, wrong: 0, wrongWords: [], answered: false, times: []
  };
  document.getElementById('readingActive').style.display = '';
  document.getElementById('readingResults').style.display = 'none';
  renderReadingQuestion();
}

// ===== CLOUD SYNC =====
const SYNC_CONFIG_KEY = 'worddrill_sync_config';
let syncRef = null;
let syncEnabled = false;
let isMerging = false;

function loadSyncConfig() {
  try { return JSON.parse(localStorage.getItem(SYNC_CONFIG_KEY)) || null; }
  catch(e) { return null; }
}

function hashSyncId(str) {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    hash = ((hash << 5) - hash) + str.charCodeAt(i);
    hash = hash & hash;
  }
  return 'id_' + Math.abs(hash).toString(36);
}

function initSync() {
  const config = loadSyncConfig();
  if (!config || !config.databaseURL || !config.apiKey || !config.syncId) {
    updateSyncStatus('æœªæ¥ç¶š');
    return;
  }
  try {
    if (!firebase.apps.length) {
      firebase.initializeApp({
        apiKey: config.apiKey,
        databaseURL: config.databaseURL,
        projectId: config.databaseURL.replace('https://','').split('.')[0].replace('-default-rtdb','')
      });
    }
    const db = firebase.database();
    syncRef = db.ref('worddrill/' + hashSyncId(config.syncId));
    syncEnabled = true;
    updateSyncStatus('æ¥ç¶šä¸­...');

    syncRef.on('value', (snapshot) => {
      const remote = snapshot.val();
      if (remote && remote.state) {
        mergeRemoteState(remote.state);
      }
      updateSyncStatus('åŒæœŸæ¸ˆã¿', true);
    }, (err) => {
      console.error('Firebase sync error:', err);
      syncEnabled = false;
      if (err.code === 'PERMISSION_DENIED') {
        updateSyncStatus('æ¨©é™ã‚¨ãƒ©ãƒ¼: DBãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèª', false, true);
      } else {
        updateSyncStatus(err.message || 'ã‚¨ãƒ©ãƒ¼', false, true);
      }
    });
  } catch(e) {
    console.error('Firebase init error:', e);
    updateSyncStatus('æ¥ç¶šã‚¨ãƒ©ãƒ¼: ' + e.message, false, true);
  }
}

function pushToCloud() {
  if (!syncRef || !syncEnabled || isMerging) return;
  syncRef.set({ state: state, updatedAt: Date.now() }).catch((err) => {
    console.error('Firebase push error:', err);
  });
}

function mergeRemoteState(remote) {
  if (isMerging) return;
  isMerging = true;

  let changed = false;

  // Merge wordStats: take max of monotonic counters
  if (remote.wordStats) {
    for (const word in remote.wordStats) {
      const r = remote.wordStats[word];
      if (!state.wordStats[word]) {
        state.wordStats[word] = { correct: r.correct || 0, wrong: r.wrong || 0, lastSeen: r.lastSeen || null };
        changed = true;
      } else {
        const l = state.wordStats[word];
        const newC = Math.max(l.correct || 0, r.correct || 0);
        const newW = Math.max(l.wrong || 0, r.wrong || 0);
        if (newC !== l.correct || newW !== l.wrong) { changed = true; }
        l.correct = newC;
        l.wrong = newW;
        if (r.lastSeen && (!l.lastSeen || r.lastSeen > l.lastSeen)) l.lastSeen = r.lastSeen;
      }
    }
  }

  // Merge dailyLog: take max values, union word lists
  if (remote.dailyLog) {
    for (const date in remote.dailyLog) {
      const r = remote.dailyLog[date];
      if (!state.dailyLog[date]) {
        state.dailyLog[date] = { sessions: r.sessions || 0, correct: r.correct || 0, wrong: r.wrong || 0, words: r.words ? [...r.words] : [] };
        changed = true;
      } else {
        const l = state.dailyLog[date];
        const newS = Math.max(l.sessions || 0, r.sessions || 0);
        const newC = Math.max(l.correct || 0, r.correct || 0);
        const newW = Math.max(l.wrong || 0, r.wrong || 0);
        if (newS !== l.sessions || newC !== l.correct || newW !== l.wrong) { changed = true; }
        l.sessions = newS; l.correct = newC; l.wrong = newW;
        if (r.words) {
          if (!l.words) l.words = [];
          r.words.forEach(w => { if (!l.words.includes(w)) { l.words.push(w); changed = true; } });
        }
      }
    }
  }

  if (changed) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    renderHome();
  }

  isMerging = false;
}

function updateSyncStatus(text, connected, error) {
  const el = document.getElementById('syncStatus');
  if (el) {
    el.textContent = text;
    el.className = connected ? 'connected' : error ? 'error' : '';
  }
  const btn = document.getElementById('syncBtn');
  if (btn) btn.classList.toggle('synced', !!connected);
}

function openSyncModal() {
  const config = loadSyncConfig() || {};
  document.getElementById('syncDbUrl').value = config.databaseURL || '';
  document.getElementById('syncApiKey').value = config.apiKey || '';
  document.getElementById('syncIdInput').value = config.syncId || '';
  document.getElementById('syncModal').classList.add('open');
}

function closeSyncModal() {
  document.getElementById('syncModal').classList.remove('open');
}

function startSync() {
  const databaseURL = document.getElementById('syncDbUrl').value.trim();
  const apiKey = document.getElementById('syncApiKey').value.trim();
  const syncId = document.getElementById('syncIdInput').value.trim();
  if (!databaseURL || !apiKey || !syncId) { toast('å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }

  localStorage.setItem(SYNC_CONFIG_KEY, JSON.stringify({ databaseURL, apiKey, syncId }));

  if (syncRef) { syncRef.off(); syncRef = null; }
  syncEnabled = false;

  const doInit = () => { initSync(); closeSyncModal(); toast('åŒæœŸã‚’é–‹å§‹ã—ã¾ã—ãŸ'); };

  if (firebase.apps.length) {
    firebase.app().delete().then(doInit);
  } else {
    doInit();
  }
}

function disconnectSync() {
  if (syncRef) { syncRef.off(); syncRef = null; }
  syncEnabled = false;
  localStorage.removeItem(SYNC_CONFIG_KEY);
  updateSyncStatus('æœªæ¥ç¶š');
  document.getElementById('syncBtn').classList.remove('synced');
  closeSyncModal();
  toast('åŒæœŸã‚’è§£é™¤ã—ã¾ã—ãŸ');
}

// ===== INIT =====
renderHome();
initSync();
</script>
</body>
</html>
